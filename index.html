
<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kasa Açma Oyunu MK</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <style>
    /* Preloader Stilleri */
    #preloader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle, #1a1a1a, #000000);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      transition: opacity 1s ease-out, visibility 1s ease-out;
      color: white;
    }

    #preloader.hidden {
      opacity: 0;
      visibility: hidden;
    }

    .loader {
      border: 8px solid #333;
      border-top: 8px solid #00ffff;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1.5s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    #preloader h2 {
      margin-top: 20px;
      font-family: 'Orbitron', sans-serif;
      font-size: 28px;
      color: #00ff99;
      text-shadow: 0 0 10px rgba(0, 255, 153, 0.7);
    }

    body {
      margin: 0;
      font-family: 'Share Tech Mono', monospace;
      background: radial-gradient(circle, #1a1a1a, #000000);
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      overflow-x: hidden;
      padding: 20px;
      box-sizing: border-box;
    }
    
    #global-announcement {
        position: fixed;
        top: -100px;
        left: 50%;
        transform: translateX(-50%);
        width: 90%;
        max-width: 600px;
        background: linear-gradient(45deg, gold, orange);
        color: #1a1a1a;
        text-align: center;
        padding: 10px;
        border-radius: 0 0 15px 15px;
        font-family: 'Orbitron', sans-serif;
        font-size: 18px;
        font-weight: bold;
        z-index: 10000;
        box-shadow: 0 5px 20px rgba(255, 215, 0, 0.5);
        transition: top 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        text-shadow: 0 1px 1px rgba(255, 255, 255, 0.3);
    }
    #global-announcement.show {
        top: 0;
    }
    
    #user-profile-display {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1001;
      display: none; /* JS ile görünür yapılacak */
      align-items: center;
      gap: 10px;
      background-color: rgba(0, 0, 0, 0.6);
      padding: 8px 15px;
      border-radius: 25px;
      border: 1px solid #00ffff;
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
      font-family: 'Orbitron', sans-serif;
    }
    #user-profile-display img {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 2px solid #00ff99;
    }
    #user-profile-display span {
      font-size: 16px;
      font-weight: bold;
      color: #fff;
    }

    h1 {
      margin-bottom: 20px;
      margin-top: 50px;
      font-size: 40px;
      background: linear-gradient(45deg, #00ffff, #8a2be2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-family: 'Orbitron', sans-serif;
      text-shadow: 0 0 15px rgba(0, 255, 255, 0.7);
    }

    #current-time {
      font-size: 24px;
      margin-bottom: 20px;
      color: #00ff99;
      font-family: 'Orbitron', sans-serif;
      text-shadow: 0 0 10px rgba(0, 255, 153, 0.7);
    }

    #stats {
      display: flex;
      gap: 30px;
      margin-bottom: 25px;
      font-size: 20px;
      background-color: rgba(0, 0, 0, 0.5);
      padding: 10px 20px;
      border-radius: 10px;
      border: 1px solid #00ffff;
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
      flex-wrap: wrap; /* Mobil için */
      justify-content: center;
    }

    #stats > div {
        display: flex;
        align-items: center;
    }

    #balance span, #case-cost span, #player-xp span {
      margin-left: 8px;
      font-weight: bold;
      color: #00ff99;
    }
    
    #main-container {
      display: flex;
      flex-direction: row;
      gap: 25px;
      width: 100%;
      max-width: 1100px;
      align-items: flex-start;
      margin-top: 10px;
    }

    #game-core {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
    }
    
    #side-info {
        width: 280px;
        flex-shrink: 0;
    }

    #main-screen-probability {
        background-color: rgba(0, 0, 0, 0.5);
        padding: 15px;
        border-radius: 10px;
        border: 1px solid #00ffff;
        box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
    }

    #main-screen-probability h3 {
        font-family: 'Orbitron', sans-serif;
        font-size: 20px;
        margin-top: 0;
        margin-bottom: 10px;
        background: linear-gradient(45deg, #00ffff, #8a2be2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }
    
    #main-screen-probability p {
        font-size: 13px;
        color: #ccc;
        margin-bottom: 15px;
        line-height: 1.4;
    }


    #case {
      width: 100%;
      max-width: 700px;
      overflow: hidden;
      border: 3px solid #00ffff;
      border-radius: 15px;
      background: #0d0d0d;
      position: relative;
      box-shadow: 0 0 30px rgba(0, 255, 255, 0.7);
      margin-bottom: 25px;
    }

    #items {
      display: flex;
      transition: transform 3.5s cubic-bezier(0.25, 1, 0.5, 1);
    }

    .item {
      min-width: 120px;
      height: 120px;
      margin: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      border-radius: 10px;
      box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.7);
      transition: transform 0.3s, box-shadow 0.3s, filter 0.3s;
      text-align: center;
      padding: 5px;
      box-sizing: border-box;
      position: relative;
      overflow: hidden;
      flex-shrink: 0;
    }

    .item img, .inventory-item img, .item-details-modal .item-display img, .daily-reward-item img {
      width: 80%;
      height: 65%;
      object-fit: contain;
      margin-bottom: 5px;
      filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5));
      transition: filter 0.3s;
    }

    .item.highlighted {
      box-shadow: 0 0 30px white, 0 0 60px currentColor, inset 0 0 20px rgba(255, 255, 255, 0.8);
      transform: scale(1.15);
      border: 3px solid white;
    }

    .item-name {
        font-size: 14px;
        position: absolute;
        bottom: 5px;
        width: 100%;
        padding: 0 5px;
        box-sizing: border-box;
    }

    /* Nadirlik renkleri */
    .trash { background: linear-gradient(135deg, #4d331f, #61412c); border: 2px solid #61412c; }
    .trash .item-name { color: #d1c0b4; }
    .common { background: linear-gradient(135deg, #333, #555); border: 2px solid #555; }
    .common .item-name { color: #ccc; }
    .uncommon { background: linear-gradient(135deg, #2f855a, #48bb78); border: 2px solid #48bb78; }
    .uncommon .item-name { color: #c6f6d5; }
    .rare { background: linear-gradient(135deg, #2b6cb0, #4299e1); border: 2px solid #4299e1; }
    .rare .item-name { color: #90cdf4; }
    .epic { background: linear-gradient(135deg, #6b46c1, #805ad5); border: 2px solid #805ad5; }
    .epic .item-name { color: #d6bcfa; }
    .exotic { background: linear-gradient(135deg, #dd6b20, #ed8936); border: 2px solid #ed8936; }
    .exotic .item-name { color: #fbd38d; }
    .mythic { background: linear-gradient(135deg, #007d7d, #00a3a3); border: 2px solid #00a3a3; }
    .mythic .item-name { color: #b2f5ea; }
    .legendary { background: linear-gradient(135deg, #a0aec0, #cbd5e0); border: 2px solid #cbd5e0; }
    .legendary .item-name { color: #4a5568; }
    .ancient { background: linear-gradient(135deg, #e53e3e, #f56565); border: 2px solid #f56565; }
    .ancient .item-name { color: #fed7d7; }
    .immortal { background: linear-gradient(135deg, #d69e2e, #ecc94b); border: 2px solid #ecc94b; }
    .immortal .item-name { color: #feebc8; }
    .divine { background: linear-gradient(135deg, #fffacd, #f0e68c); border: 2px solid #fffacd; text-shadow: 0 0 8px #ffd700; }
    .divine .item-name { color: #5a5229; }
    
    .chroma {
        border: 2px solid;
        border-image-slice: 1;
        border-image-source: linear-gradient(to right, red, orange, yellow, green, blue, indigo, violet);
        animation: rgb-bg 4s linear infinite;
        background-size: 400% 400%;
    }
    .chroma .item-name { animation: rgb-text 4s linear infinite; }

    @keyframes rgb-bg {
        0%{background-position:0% 50%}
        50%{background-position:100% 50%}
        100%{background-position:0% 50%}
    }
    @keyframes rgb-text {
        0%{color: #ff0000;}
        17%{color: #ff7f00;}
        33%{color: #ffff00;}
        50%{color: #00ff00;}
        67%{color: #0000ff;}
        83%{color: #4b0082;}
        100%{color: #ff0000;}
    }

    #openBtn {
      padding: 16px 35px;
      font-size: 22px;
      border: none;
      border-radius: 15px;
      background: linear-gradient(45deg, #00ff99, #00ccff);
      color: white;
      cursor: pointer;
      box-shadow: 0 0 20px #00ffd0, 0 0 40px rgba(0, 255, 208, 0.5);
      transition: all 0.3s ease;
      font-family: 'Orbitron', sans-serif;
    }

    #openBtn:hover {
      background: linear-gradient(45deg, #00cc77, #0099cc);
      transform: translateY(-3px);
      box-shadow: 0 5px 25px #00ffd0, 0 5px 50px rgba(0, 255, 208, 0.7);
    }

    #openBtn:disabled {
      background: linear-gradient(45deg, #444, #666);
      cursor: not-allowed;
      box-shadow: none;
    }
    
    .toggle-switch {
      position: relative;
      display: inline-flex;
      align-items: center;
      width: 120px;
      height: 40px;
      background-color: #333;
      border-radius: 20px;
      cursor: pointer;
      border: 1px solid #8a2be2;
    }
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .slider {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #555;
      transition: .4s;
      border-radius: 20px;
    }
    .slider:before {
      position: absolute;
      content: "";
      height: 32px;
      width: 32px;
      left: 4px;
      bottom: 3px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    .toggle-switch input:checked + .slider {
      background-color: #00ff99;
    }
    .toggle-switch input:checked + .slider:before {
      transform: translateX(80px);
    }
    .toggle-label {
        font-family: 'Orbitron', sans-serif;
        font-size: 14px;
        margin-left: 40px;
        color: white;
        pointer-events: none;
        z-index: 1;
        transition: color 0.4s;
    }
    .toggle-switch input:checked ~ .toggle-label {
        color: #1a1a1a;
        margin-left: 8px;
    }

    #result {
      margin-top: 15px;
      font-size: 26px;
      font-weight: bold;
      text-shadow: 0 0 15px #fff, 0 0 25px currentColor;
      text-align: center;
      min-height: 40px;
    }

    .highlight {
      animation: pop 0.6s ease-out;
    }

    @keyframes pop {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.4); opacity: 1; text-shadow: 0 0 20px #fff, 0 0 30px currentColor; }
      100% { transform: scale(1); opacity: 1; }
    }

    .selector {
      position: absolute;
      top: 0;
      bottom: 0;
      left: 50%;
      width: 6px;
      background: #ff00ea;
      transform: translateX(-50%);
      z-index: 10;
      box-shadow: 0 0 15px #ff00ea, 0 0 25px rgba(255, 0, 234, 0.7);
      border-radius: 3px;
    }

    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        visibility: hidden;
        opacity: 0;
        transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
    }

    .modal-overlay.show {
        visibility: visible;
        opacity: 1;
    }

    .modal-content {
        background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
        border: 2px solid #00ffff;
        border-radius: 15px;
        padding: 30px;
        text-align: center;
        box-shadow: 0 0 40px rgba(0, 255, 255, 0.7);
        max-width: 90%;
        max-height: 90%;
        overflow-y: auto;
        transform: translateY(-20px);
        transition: transform 0.3s ease-in-out;
        position: relative;
    }
    .modal-overlay.show .modal-content {
        transform: translateY(0);
    }

    .modal-content h2, .modal-content h3 {
        font-family: 'Orbitron', sans-serif;
        font-size: 28px;
        margin-bottom: 15px;
        background: linear-gradient(45deg, #00ffff, #8a2be2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .modal-content button.close-btn {
        position: absolute;
        top: 15px;
        right: 15px;
        background: none;
        border: none;
        color: #00ffff;
        font-size: 30px;
        cursor: pointer;
        transition: transform 0.2s;
    }
    .modal-content button.close-btn:hover {
        transform: scale(1.2);
    }

    #inventoryModal .modal-content {
      max-width: 800px;
    }
    #inventory-filters {
        margin-bottom: 20px;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
    }
    #inventory-filters select, #inventory-filters button {
        padding: 8px 15px;
        border-radius: 8px;
        border: 1px solid #00ffff;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        font-family: 'Share Tech Mono', monospace;
        font-size: 14px;
        cursor: pointer;
        transition: background-color 0.2s, border-color 0.2s;
    }
    #inventory-filters select:hover, #inventory-filters button:hover {
        background-color: rgba(0, 255, 255, 0.2);
        border-color: #00ff99;
    }
    #inventory-filters button.active {
        background-color: #00ffff;
        color: #1a1a1a;
        box-shadow: 0 0 8px #00ffff;
    }
    #inventory {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
      min-height: 150px;
    }

    .inventory-item {
      width: 100px;
      height: 100px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      border: 2px solid;
      padding: 5px;
      box-sizing: border-box;
      text-align: center;
      font-size: 12px;
      font-weight: bold;
      color: white;
      position: relative;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .inventory-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(138, 43, 226, 0.5);
    }

    .inventory-item-name {
      font-size: 10px;
      position: absolute;
      bottom: 3px;
      width: 100%;
    }

    .inventory-item.favorite {
        border-color: gold !important;
        box-shadow: 0 0 10px gold, inset 0 0 5px gold !important;
    }
    .inventory-item .favorite-star {
        position: absolute;
        top: 5px;
        right: 5px;
        color: gold;
        font-size: 18px;
        text-shadow: 0 0 5px rgba(255, 215, 0, 0.7);
    }

    .inventory-item.trash { background: #4d331f; border-color: #61412c; }
    .inventory-item.trash .inventory-item-name { color: #d1c0b4; }
    .inventory-item.common { background: #333; border-color: #555; }
    .inventory-item.common .inventory-item-name { color: #ccc; }
    .inventory-item.uncommon { background: #2f855a; border-color: #48bb78; }
    .inventory-item.uncommon .inventory-item-name { color: #c6f6d5; }
    .inventory-item.rare { background: #2b6cb0; border-color: #4299e1; }
    .inventory-item.rare .inventory-item-name { color: #90cdf4; }
    .inventory-item.epic { background: #6b46c1; border-color: #805ad5; }
    .inventory-item.epic .inventory-item-name { color: #d6bcfa; }
    .inventory-item.exotic { background: #dd6b20; border-color: #ed8936; }
    .inventory-item.exotic .inventory-item-name { color: #fbd38d; }
    .inventory-item.mythic { background: #007d7d; border-color: #00a3a3; }
    .inventory-item.mythic .inventory-item-name { color: #b2f5ea; }
    .inventory-item.legendary { background: #a0aec0; border-color: #cbd5e0; }
    .inventory-item.legendary .inventory-item-name { color: #4a5568; }
    .inventory-item.ancient { background: #e53e3e; border-color: #f56565; }
    .inventory-item.ancient .item-name { color: #fed7d7; }
    .inventory-item.immortal { background: #d69e2e; border-color: #ecc94b; }
    .inventory-item.immortal .item-name { color: #feebc8; }
    .inventory-item.divine { background: #fffacd; border-color: #f0e68c; }
    .inventory-item.divine .inventory-item-name { color: #5a5229; }
    .inventory-item.chroma {
        border-image-source: linear-gradient(to right, red, orange, yellow, green, blue, indigo, violet);
        animation: rgb-bg 4s linear infinite;
        background-size: 400% 400%;
    }

    #boostShopModal .modal-content {
      max-width: 700px;
    }
    #boosts-container {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        justify-content: center;
    }
    .boost-item {
        width: 150px;
        height: 120px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        border-radius: 10px;
        border: 2px solid;
        padding: 10px;
        box-sizing: border-box;
        text-align: center;
        font-size: 14px;
        font-weight: bold;
        color: white;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
        position: relative;
    }

    .boost-item:hover:not(:disabled) {
        transform: translateY(-5px);
        box-shadow: 0 5px 20px rgba(0, 255, 255, 0.5);
    }

    .boost-item.disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }

    .boost-item .boost-name {
        font-size: 16px;
        margin-bottom: 5px;
        font-family: 'Orbitron', sans-serif;
    }

    .boost-item .boost-description {
        font-size: 12px;
        margin-bottom: 8px;
        opacity: 0.8;
    }

    .boost-item .boost-price {
        font-size: 15px;
        font-weight: bold;
        color: #00ff99;
        position: absolute;
        bottom: 8px;
    }

    .boost-item.common-boost { background: linear-gradient(135deg, #333, #555); border-color: #555; }
    .boost-item.rare-boost { background: linear-gradient(135deg, #2b6cb0, #4299e1); border-color: #4299e1; }
    .boost-item.epic-boost { background: linear-gradient(135deg, #6b46c1, #805ad5); border-color: #805ad5; }
    .boost-item.legendary-boost { background: linear-gradient(135deg, #dd6b20, #ed8936); border-color: #ed8936; }
    .boost-item.immortal-boost { background: linear-gradient(135deg, #d69e2e, #ecc94b); border-color: #ecc94b; }

    #errorMessage {
      color: #ff4d4d;
      font-size: 18px;
      font-weight: bold;
      margin-top: 20px;
      text-align: center;
      min-height: 25px;
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
    }
    #errorMessage.show {
      visibility: visible;
      opacity: 1;
    }

    .item-details-modal {
        max-width: 400px;
    }
    .item-details-modal h3 {
        font-family: 'Orbitron', sans-serif;
        font-size: 28px;
        margin-bottom: 15px;
        background: linear-gradient(45deg, #00ffff, #8a2be2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .item-details-modal .item-display {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 20px;
    }
    .item-details-modal .item-display img {
        width: 150px;
        height: 150px;
        object-fit: contain;
        margin-bottom: 10px;
        border-radius: 10px;
        border: 2px solid currentColor;
        box-shadow: 0 0 15px currentColor;
    }
    .item-details-modal .item-display .item-rarity-text {
        font-size: 18px;
        font-weight: bold;
        text-transform: uppercase;
        margin-top: 5px;
    }

    .modal-buttons {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 20px;
    }

    .modal-buttons button {
        padding: 12px 25px;
        font-size: 18px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.2s ease;
        font-family: 'Share Tech Mono', monospace;
        color: white;
    }

    .modal-buttons button.sell-btn {
        background: linear-gradient(45deg, #ff4d4d, #cc0000);
        box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
    }
    .modal-buttons button.sell-btn:hover {
        background: linear-gradient(45deg, #cc0000, #990000);
        transform: translateY(-2px);
    }

    .modal-buttons button.favorite-btn {
        background: linear-gradient(45deg, #ffd700, #ff8c00);
        box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    }
    .modal-buttons button.favorite-btn.active {
        background: linear-gradient(45deg, #ccaa00, #cc7000);
        box-shadow: 0 0 15px gold;
        transform: translateY(-2px);
    }
    .modal-buttons button.favorite-btn:hover {
        background: linear-gradient(45deg, #ffcc00, #ffa500);
        transform: translateY(-2px);
    }

    .modal-buttons button.close-btn-small {
        background: linear-gradient(45deg, #555, #333);
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
    }
    .modal-buttons button.close-btn-small:hover {
        background: linear-gradient(45deg, #333, #111);
        transform: translateY(-2px);
    }

    .modal-message {
        margin-top: 15px;
        font-size: 16px;
        color: #00ff99;
        font-weight: bold;
    }

    #versionPatchesModal .modal-content {
      max-width: 600px;
    }
    #patches-list {
      list-style: none;
      padding: 0;
      margin: 0;
      text-align: left;
      max-height: 400px;
      overflow-y: auto;
    }

    #patches-list li {
      margin-bottom: 8px;
      padding-bottom: 8px;
      border-bottom: 1px dashed rgba(0, 255, 255, 0.3);
      line-height: 1.4;
    }

    #patches-list li:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }

    #patches-list li strong {
      color: #00ff99;
      font-size: 15px;
    }
    
    #event-timer-bar {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background: linear-gradient(45deg, gold, orange);
        color: #1a1a1a;
        text-align: center;
        padding: 8px;
        font-family: 'Orbitron', sans-serif;
        font-size: 16px;
        font-weight: bold;
        z-index: 998;
        box-shadow: 0 -5px 15px rgba(255, 215, 0, 0.4);
        display: none;
        transition: background 0.5s;
    }
    body.event-active {
        padding-bottom: 40px; /* Make space for the bar */
    }

    #achievementsModal .modal-content {
      max-width: 900px;
    }
    #achievements-list {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        justify-content: center;
        min-height: 100px;
    }

    .achievement-item {
        background-color: rgba(0, 0, 0, 0.7);
        border: 2px solid #8a2be2;
        border-radius: 10px;
        padding: 15px;
        width: 250px;
        text-align: left;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        min-height: 120px;
        box-shadow: 0 0 10px rgba(138, 43, 226, 0.5);
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .achievement-item.completed {
        border-color: gold;
        box-shadow: 0 0 15px gold;
        background-color: rgba(30, 20, 0, 0.7);
    }
    .achievement-item.completed.rgb-achievement {
        border-image-slice: 1;
        border-image-source: linear-gradient(to right, red, orange, yellow, green, blue, indigo, violet);
        animation: rgb-border-anim 4s linear infinite;
    }
    @keyframes rgb-border-anim {
        0%{border-image-source: linear-gradient(to right, red,orange,yellow,green,blue,indigo,violet);}
        100%{border-image-source: linear-gradient(to right, violet,indigo,blue,green,yellow,orange,red);}
    }
    .achievement-item.completed.rgb-achievement h4 {
        animation: rgb-text 4s linear infinite;
    }

    .achievement-item h4 {
        color: #00ffff;
        font-family: 'Orbitron', sans-serif;
        margin-top: 0;
        margin-bottom: 10px;
        font-size: 18px;
    }

    .achievement-item p {
        font-size: 14px;
        color: #e0f7fa;
        margin-bottom: 10px;
        flex-grow: 1;
    }

    .achievement-item .reward-text {
        font-size: 14px;
        font-weight: bold;
        color: #00ff99;
    }
    .achievement-item.completed .reward-text {
        color: gold;
    }

    .achievement-item .completion-status {
        font-size: 12px;
        color: #ccc;
        margin-top: 5px;
        font-style: italic;
    }
    .achievement-item.completed .completion-status {
        color: #00ff99;
        font-weight: bold;
    }
    
    .achievement-progress {
        margin-top: auto;
    }
    
    .achievement-progress-container {
        width: 100%;
        height: 10px;
        background-color: #2c2c2c;
        border-radius: 5px;
        overflow: hidden;
        border: 1px solid #555;
    }

    .achievement-progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #00ff99, #00ccff);
        border-radius: 5px;
        transition: width 0.3s ease-in-out;
    }

    .achievement-progress-text {
        font-size: 12px;
        text-align: right;
        color: #e0f7fa;
        margin-top: 3px;
    }

    #main-menu-btn {
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 1001;
        background: linear-gradient(45deg, #00ffff, #8a2be2);
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-family: 'Orbitron', sans-serif;
        font-size: 20px;
        box-shadow: 0 0 15px rgba(0, 255, 255, 0.7);
        transition: all 0.3s ease;
    }
    #main-menu-btn:hover {
        background: linear-gradient(45deg, #00b0b0, #6a1ac1);
        transform: scale(1.05);
        box-shadow: 0 0 20px rgba(0, 255, 255, 0.9);
    }

    #mainMenuModal .modal-content {
        max-width: 650px;
    }
    #mainMenuModal .menu-grid {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 20px 15px;
    }
    #mainMenuModal .menu-category {
      grid-column: 1 / -1; /* Span all columns */
      text-align: left;
      font-family: 'Orbitron', sans-serif;
      font-size: 20px;
      color: #00ff99;
      margin-top: 10px;
      margin-bottom: -5px;
      padding-left: 5px;
      border-bottom: 1px solid rgba(0,255,153,0.4);
    }
    #mainMenuModal .menu-category:first-of-type {
      margin-top: 0;
    }
    #mainMenuModal .menu-options button {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 8px;
        width: 100%;
        height: 100px;
        padding: 10px;
        background: linear-gradient(45deg, #00ff99, #00ccff);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 14px;
        font-family: 'Orbitron', sans-serif;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 0 0 10px rgba(0, 255, 153, 0.5);
        position: relative;
    }
    #mainMenuModal .menu-options button:hover {
        background: linear-gradient(45deg, #00cc77, #0099cc);
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 255, 153, 0.7);
    }
    .menu-icon {
        width: 36px;
        height: 36px;
        pointer-events: none;
    }
    .menu-icon svg {
        width: 100%;
        height: 100%;
        fill: white;
    }
    .menu-text {
        pointer-events: none;
    }
    .notification-dot {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 12px;
        height: 12px;
        background-color: red;
        border-radius: 50%;
        border: 2px solid white;
        box-shadow: 0 0 10px red;
    }


    #quick-access-buttons {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 999;
        display: flex;
        flex-direction: column;
        gap: 10px;
        transition: bottom 0.3s ease-in-out;
    }

    body.event-active #quick-access-buttons {
        bottom: 60px;
    }

    .quick-access-btn {
        background: linear-gradient(45deg, #8a2be2, #00ffff);
        color: white;
        width: 50px;
        height: 50px;
        border: none;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        box-shadow: 0 0 15px rgba(138, 43, 226, 0.7);
        transition: all 0.3s ease;
    }
    .quick-access-btn:hover {
        background: linear-gradient(45deg, #6a1ac1, #00b0b0);
        transform: scale(1.1);
        box-shadow: 0 0 20px rgba(138, 43, 226, 0.9);
    }
    .quick-access-btn .quick-icon {
        width: 28px;
        height: 28px;
    }
    .quick-access-btn .quick-icon svg {
        width: 100%;
        height: 100%;
        fill: white;
    }

    #autoSellModal .modal-content {
      max-width: 500px;
    }
    #auto-sell-options {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-bottom: 20px;
        text-align: left;
    }
    #auto-sell-options label {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 18px;
        color: #e0f7fa;
    }
    #auto-sell-options input[type="checkbox"] {
        width: 20px;
        height: 20px;
        accent-color: #00ff99;
    }
    #saveAutoSellBtn {
        padding: 10px 20px;
        background: linear-gradient(45deg, #00ff99, #00ccff);
        color: white;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-size: 18px;
        transition: all 0.2s ease;
    }
    #saveAutoSellBtn:hover {
        background: linear-gradient(45deg, #00cc77, #0099cc);
        transform: translateY(-2px);
    }
    #auto-sell-status {
      font-size: 16px;
      color: #00ff99;
      margin-top: 10px;
    }

    #autoOpenModal .modal-content {
      max-width: 500px;
    }
    #auto-open-info {
        font-size: 16px;
        color: #e0f7fa;
        margin-bottom: 15px;
    }
    #auto-open-controls {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-top: 20px;
    }
    #auto-open-start-btn, #auto-open-stop-btn {
        padding: 12px 25px;
        font-size: 18px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.2s ease;
        font-family: 'Share Tech Mono', monospace;
        color: white;
    }
    #auto-open-start-btn {
        background: linear-gradient(45deg, #00ff99, #00ccff);
    }
    #auto-open-start-btn:hover:not(:disabled) {
        background: linear-gradient(45deg, #00cc77, #0099cc);
        transform: translateY(-2px);
    }
    #auto-open-start-btn:disabled {
        background: linear-gradient(45deg, #444, #666);
        cursor: not-allowed;
    }
    #auto-open-stop-btn {
        background: linear-gradient(45deg, #ff4d4d, #cc0000);
    }
    #auto-open-stop-btn:hover:not(:disabled) {
        background: linear-gradient(45deg, #cc0000, #990000);
        transform: translateY(-2px);
    }

    #auto-open-count {
      font-size: 20px;
      color: #00ff99;
      margin-top: 15px;
    }

    #languageSelectModal .modal-content {
        max-width: 500px;
    }
    #language-options {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
    }
    #language-options button {
        padding: 12px 20px;
        font-size: 18px;
        background: linear-gradient(45deg, #00ffff, #8a2be2);
        color: white;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.2s ease;
        font-family: 'Orbitron', sans-serif;
    }
    #language-options button:hover {
        background: linear-gradient(45deg, #00ccff, #6a1ac1);
        transform: translateY(-2px);
    }
    #language-options button.selected {
        background: linear-gradient(45deg, #00ff99, #00ccff);
        box-shadow: 0 0 15px rgba(0, 255, 153, 0.7);
    }

    #dailyRewardModal .modal-content {
        max-width: 750px;
    }
    #daily-rewards-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 15px;
        margin-top: 20px;
    }
    .daily-reward-item {
        border: 2px solid #666;
        border-radius: 10px;
        padding: 15px;
        background-color: rgba(0,0,0,0.5);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        position: relative;
    }
    .daily-reward-item.claimable {
        border-color: #00ff99;
        box-shadow: 0 0 15px #00ff99;
        cursor: pointer;
        transform: scale(1.05);
    }
    .daily-reward-item.claimed {
        border-color: #8a2be2;
        opacity: 0.7;
    }
    .claimed-overlay {
        position: absolute;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(40, 20, 80, 0.7);
        border-radius: 8px; /* match parent's radius */
        display: flex;
        justify-content: center;
        align-items: center;
        color: #d6bcfa;
        font-family: 'Orbitron', sans-serif;
        font-size: 20px;
        font-weight: bold;
        text-shadow: 0 0 8px #8a2be2;
        pointer-events: none; /* allows hover effects on parent if any */
    }
    .daily-reward-item .day-number {
        font-family: 'Orbitron', sans-serif;
        font-size: 18px;
        margin-bottom: 10px;
    }
    .daily-reward-item .reward-preview img {
        width: 60px;
        height: 60px;
    }
    .daily-reward-item .reward-preview span {
        font-size: 24px;
        font-weight: bold;
        color: #00ff99;
    }
    .daily-reward-item .reward-name {
        font-size: 12px;
        margin-top: 8px;
        text-align: center;
    }

    #csPathModal .modal-content {
        max-width: 600px;
    }
    #cs-path-progress-bar-container {
        width: 100%;
        height: 30px;
        background-color: #222;
        border-radius: 15px;
        border: 1px solid #00ffff;
        margin-bottom: 10px;
        overflow: hidden;
    }
    #cs-path-progress-bar {
        width: 0%;
        height: 100%;
        background: linear-gradient(90deg, #00ff99, #00ccff);
        border-radius: 15px;
        transition: width 0.5s ease;
    }
    #cs-path-xp-text {
        font-size: 16px;
        margin-bottom: 20px;
    }
    #cs-path-rewards-list {
        max-height: 50vh;
        overflow-y: auto;
        padding-right: 10px;
    }
    .cs-path-tier {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background-color: rgba(0, 0, 0, 0.4);
        border: 1px solid #444;
        border-radius: 10px;
        padding: 10px 15px;
        margin-bottom: 10px;
        transition: all 0.3s;
    }
    .cs-path-tier.unlocked {
      border-color: #00ff99;
      box-shadow: 0 0 8px rgba(0, 255, 153, 0.5);
    }
    .cs-path-tier.claimed {
      border-color: #8a2be2;
      opacity: 0.6;
    }
    .cs-path-tier-info {
        text-align: left;
    }
    .cs-path-tier-info .tier-level {
        font-family: 'Orbitron', sans-serif;
        color: #00ffff;
        font-size: 18px;
    }
    .cs-path-tier-info .tier-reward {
        font-size: 14px;
        color: #ccc;
    }
    .cs-path-tier .claim-btn {
        padding: 8px 15px;
        font-size: 14px;
        background: linear-gradient(45deg, #00ff99, #00ccff);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
    }
    .cs-path-tier .claim-btn:disabled {
        background: #555;
        cursor: not-allowed;
    }

    #achievement-toast {
      position: fixed;
      top: 20px;
      right: -500px;
      z-index: 10001;
      background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
      color: white;
      border: 2px solid gold;
      border-radius: 10px;
      padding: 15px 20px;
      box-shadow: 0 5px 25px rgba(255, 215, 0, 0.4);
      display: flex;
      align-items: center;
      gap: 15px;
      transition: right 0.5s cubic-bezier(0.25, 1, 0.5, 1);
    }
    #achievement-toast.show {
      right: 20px;
    }
    #achievement-toast .toast-icon {
      font-size: 36px;
    }
    #achievement-toast .toast-content h4 {
      margin: 0 0 5px 0;
      font-family: 'Orbitron', sans-serif;
      color: gold;
    }
    #achievement-toast .toast-content p {
      margin: 0;
      font-size: 14px;
      color: #eee;
    }

    #quick-actions-container {
      display: flex;
      gap: 15px; /* Butonlar arası boşluk */
      margin-top: 20px; /* Üstteki elementle boşluk */
      align-items: center; /* Dikey hizalama */
    }
    #quick-actions-extra {
        display: flex;
        gap: 10px;
        margin-top: 15px;
        align-items: center;
        min-height: 40px; /* To prevent layout shift */
    }
    .quick-action-btn {
      padding: 8px;
      width: 50px;
      height: 40px;
      display: flex;
      justify-content: center;
      align-items: center;
      border: none;
      border-radius: 10px;
      color: white;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(138, 43, 226, 0.5);
      background: linear-gradient(45deg, #8a2be2, #6a1ac1);
      transition: all 0.2s ease;
    }
    .quick-action-btn .quick-action-icon {
        width: 24px;
        height: 24px;
    }
    .quick-action-btn .quick-action-icon svg {
        fill: white;
        width: 100%;
        height: 100%;
    }
    .quick-action-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(138, 43, 226, 0.7);
    }
    .quick-action-btn:disabled {
      background: #555;
      cursor: not-allowed;
      box-shadow: none;
    }
    #freeMoneyBtn {
        padding: 8px 15px;
        height: 40px;
        background: linear-gradient(45deg, gold, orange);
        color: #1a1a1a;
        font-weight: bold;
    }
    
    #collectionModal .modal-content {
        max-width: 900px;
    }
    #collection-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 15px;
    }
    .collection-item {
        position: relative; /* For the "NEW" badge */
        opacity: 0.4;
        filter: grayscale(80%);
    }
    .collection-item.found {
        opacity: 1;
        filter: grayscale(0%);
    }
    .collection-item.new-item::after {
        content: 'NEW';
        position: absolute;
        top: 2px;
        right: 2px;
        background: #ff2525;
        color: white;
        font-family: 'Orbitron', sans-serif;
        font-size: 10px;
        padding: 2px 4px;
        border-radius: 4px;
        box-shadow: 0 0 8px red;
        animation: pulse-new 1.5s infinite;
    }
    @keyframes pulse-new {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    #collection-progress {
        margin-bottom: 20px;
        font-size: 18px;
        font-family: 'Orbitron', sans-serif;
    }
    
    #probability-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }
    #probability-table th, #probability-table td {
        padding: 8px;
        border: 1px solid rgba(0, 255, 255, 0.3);
        text-align: left;
        font-size: 14px;
    }
    #probability-table th {
        background-color: rgba(0, 255, 255, 0.1);
        font-family: 'Orbitron', sans-serif;
    }
    #probability-table td:last-child {
        font-weight: bold;
        color: #00ff99;
    }
    
    .form-group {
        margin-bottom: 15px;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        gap: 5px;
        width: 100%;
    }
    .form-group label {
        font-size: 16px;
        color: #00ffff;
    }
    .form-group input, .form-group select {
        width: 100%;
        padding: 10px;
        background-color: rgba(0, 0, 0, 0.7);
        border: 1px solid #00ffff;
        border-radius: 8px;
        color: white;
        font-size: 16px;
        box-sizing: border-box;
    }
    .form-group button {
        padding: 10px 20px;
        font-size: 16px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        background: linear-gradient(45deg, #00ff99, #00ccff);
        color: white;
        transition: all 0.2s ease;
        align-self: flex-end;
    }
    .form-group button:hover {
        transform: translateY(-2px);
    }
    #usernameModal {
        background-color: rgba(0, 0, 0, 0.9);
    }
    #usernameModal .form-group button {
        width: 100%;
    }
    
    /* Special Win Modal */
    #specialWinModal {
      background-color: rgba(0,0,0,0.9);
    }
    #specialWinModal .modal-content {
      background: none;
      border: none;
      box-shadow: none;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      animation: special-win-fade-in 1s forwards;
    }
    @keyframes special-win-fade-in {
        from { opacity: 0; transform: scale(0.8); }
        to { opacity: 1; transform: scale(1); }
    }
    #special-win-title {
      font-size: 5vw;
      font-family: 'Orbitron', sans-serif;
      margin-bottom: 20px;
      animation: special-win-text-glow 2s infinite alternate;
    }
    #special-win-item-container {
      position: relative;
      width: 300px;
      height: 300px;
    }
    #special-win-item-image {
      width: 100%;
      height: 100%;
      object-fit: contain;
      animation: special-win-item-rotate 20s linear infinite;
    }
    @keyframes special-win-item-rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    #special-win-item-name {
      margin-top: 20px;
      font-size: 3vw;
      font-weight: bold;
    }
    #special-win-item-rarity {
        margin-top: 5px;
        font-size: 2.5vw;
        font-weight: bold;
        text-transform: uppercase;
    }

    /* Event Start Effect */
    .event-effect {
        position: fixed;
        top: 0;
        width: 20px;
        height: 100%;
        background: linear-gradient(to top, rgba(255,215,0,0), rgba(255,215,0,0.8), rgba(255,215,0,0));
        z-index: 9998;
        pointer-events: none;
        opacity: 0;
    }
    #event-effect-left { left: 5%; }
    #event-effect-right { right: 5%; }
    
    body.event-starting #event-effect-left,
    body.event-starting #event-effect-right {
        animation: event-beam-anim 2.5s forwards;
    }
    
    @keyframes event-beam-anim {
        0% { transform: translateY(-100%); opacity: 0; }
        20% { transform: translateY(0); opacity: 1; }
        80% { transform: translateY(0); opacity: 1; }
        100% { transform: translateY(100%); opacity: 0; }
    }


    @media (max-width: 900px) {
        #main-container {
            flex-direction: column;
            align-items: center;
        }
        #side-info {
            width: 100%;
            max-width: 500px;
            margin-top: 25px;
        }
        #mainMenuModal .menu-grid {
            grid-template-columns: 1fr 1fr;
        }
    }

    @media (max-width: 768px) {
      #user-profile-display {
        padding: 6px 10px;
        gap: 8px;
      }
      #user-profile-display img {
        width: 28px;
        height: 28px;
      }
      #user-profile-display span {
        font-size: 14px;
      }
      h1 { font-size: 32px; }
      #current-time { font-size: 20px; }
      #stats { gap: 15px; font-size: 16px; }
      #game-core {
          width: 100%;
      }
      #case { max-width: 100%; }
      .item { min-width: 90px; height: 90px; margin: 5px; }
      .item-name { font-size: 12px; }
      #openBtn { padding: 12px 25px; font-size: 18px; }
      #result { font-size: 20px; }
      #errorMessage { font-size: 16px; }
      .modal-content h2, .modal-content h3 { font-size: 24px; }
      .inventory-item { width: 80px; height: 80px; }
      .inventory-item-name { font-size: 9px; }
      .boost-item { width: 120px; height: 100px; padding: 8px; }
      .boost-item .boost-name { font-size: 14px; }
      .boost-item .boost-description { font-size: 10px; }
      .boost-item .boost-price { font-size: 13px; }
      .item-details-modal h3 { font-size: 22px; }
      .item-details-modal .item-display img { width: 100px; height: 100px; }
      .modal-buttons button { padding: 10px 15px; font-size: 16px; }
      #main-menu-btn { font-size: 18px; padding: 8px 12px; }
      #mainMenuModal .menu-options button { height: 80px; }
      .menu-icon { width: 28px; height: 28px; }
      .quick-access-btn { width: 45px; height: 45px; }
      .quick-access-btn .quick-icon { width: 24px; height: 24px; }
      .achievement-item { width: 100%; }
      #auto-sell-options label { font-size: 16px; }
      #auto-sell-options input[type="checkbox"] { width: 18px; height: 18px; }
      #auto-open-info { font-size: 14px; }
      #auto-open-start-btn, #auto-open-stop-btn { padding: 10px 20px; font-size: 16px; }
      #auto-open-count { font-size: 18px; }
      #language-options { grid-template-columns: 1fr; }
      #language-options button { font-size: 16px; padding: 10px 15px; }
      .daily-reward-item { padding: 10px; }
      #daily-rewards-grid { gap: 10px; }
    }

    @media (max-width: 480px) {
      #user-profile-display {
        display: none; /* Çok küçük ekranlarda gizle */
      }
      h1 { font-size: 28px; text-align: center; }
      #current-time { font-size: 18px; }
      #stats { width: 90%; }
      #case { border-radius: 10px; }
      .item { min-width: 70px; height: 70px; margin: 4px; font-size: 10px; }
      .item-name { font-size: 10px; }
      #openBtn { padding: 10px 20px; font-size: 16px; }
      #result { font-size: 18px; }
      #errorMessage { font-size: 14px; }
      .modal-content h2, .modal-content h3 { font-size: 20px; }
      .inventory-item { width: 70px; height: 70px; margin: 8px; }
      .boost-item { width: 100px; height: 90px; padding: 5px; }
      .boost-item .boost-name { font-size: 12px; }
      .boost-item .boost-description { font-size: 9px; }
      .boost-item .boost-price { font-size: 11px; }
      .item-details-modal h3 { font-size: 20px; }
      .item-details-modal .item-display img { width: 80px; height: 80px; }
      .modal-buttons { flex-direction: column; gap: 10px; }
      .modal-buttons button { width: 100%; }
      #main-menu-btn { font-size: 16px; padding: 6px 10px; }
      #mainMenuModal .menu-grid { grid-template-columns: 1fr; gap: 10px; }
      #mainMenuModal .menu-category { font-size: 18px; }
      .menu-icon { width: 24px; height: 24px; }
      .quick-access-btn { width: 40px; height: 40px; }
      .quick-access-btn .quick-icon { width: 20px; height: 20px; }
      #auto-sell-options label { font-size: 14px; }
      #auto-sell-options input[type="checkbox"] { width: 16px; height: 16px; }
      #auto-open-info { font-size: 12px; }
      #auto-open-start-btn, #auto-open-stop-btn { padding: 8px 15px; font-size: 14px; }
      #auto-open-count { font-size: 16px; }
      #language-options button { font-size: 14px; padding: 8px 12px; }
      #achievement-toast { width: 90%; right: -100%; top: 10px; }
      #achievement-toast.show { right: 5%; }
      #quick-actions-container { flex-direction: column; gap: 10px; }
      #special-win-item-container { width: 200px; height: 200px; }
      #special-win-title { font-size: 8vw; }
      #special-win-item-name { font-size: 5vw; }
      #special-win-item-rarity { font-size: 4vw; }
    }
  </style>
</head>
<body id="body">
  <div id="preloader">
    <div class="loader"></div>
    <h2 data-lang-key="loading">Yükleniyor...</h2>
  </div>

  <div id="event-effect-left" class="event-effect"></div>
  <div id="event-effect-right" class="event-effect"></div>
  
  <div id="user-profile-display">
    <img id="profile-avatar" src="" alt="Avatar">
    <span id="profile-username"></span>
  </div>

  <div id="global-announcement"></div>
  <div id="event-timer-bar"></div>

  <div id="achievement-toast">
      <span class="toast-icon">🏆</span>
      <div class="toast-content">
          <h4 id="toast-title"></h4>
          <p id="toast-desc"></p>
      </div>
  </div>

  <button id="main-menu-btn" data-lang-key="menuBtn">☰ Menü</button>

  <h1 data-lang-key="gameTitle">🎁 Kasa Açma Simülasyonu MK</h1>

  <div id="current-time"></div> 

  <div id="stats">
    <div id="balance" data-lang-key="balance">Bakiye: <span id="balance-amount">1000</span>$</div>
    <div id="case-cost" data-lang-key="caseCost">Kasa Maliyeti: <span id="cost-amount">100</span>$</div>
    <div id="player-xp" data-lang-key="playerXP">XP: <span id="xp-amount">0</span></div>
  </div>

  <div id="main-container">
    <div id="game-core">
        <div id="case">
            <div class="selector"></div>
            <div id="items"></div>
        </div>
        
        <div id="quick-actions-container">
            <button id="openBtn" data-lang-key="openCaseBtn">Kasayı Aç</button>
            <label id="autoOpenToggleContainer" class="toggle-switch" style="display: none;">
                <input type="checkbox" id="autoOpenToggle">
                <span class="slider"></span>
                <span class="toggle-label" data-lang-key="autoOpenBtn">Oto-Aç</span>
            </label>
        </div>

        <div id="quick-actions-extra">
            <button id="freeMoneyBtn" class="quick-action-btn" style="display: none;"></button>
            <button id="sellLastBtn" class="quick-action-btn" disabled>
                <span class="quick-action-icon">
                    <svg viewBox="0 0 24 24"><path d="M11 18h2v-4h4v-2h-4V8h-2v4H7v2h4zm-5 4h14V6H6zM8 2h8v2H8z"/></svg>
                </span>
            </button>
            <button id="muteBtn" class="quick-action-btn">
                <span class="quick-action-icon" id="muteIconContainer">
                    <!-- SVG will be injected here by script -->
                </span>
            </button>
        </div>

        <div id="result"></div>
        <div id="errorMessage"></div>
    </div>

    <div id="side-info">
        <div id="main-screen-probability">
            <h3 data-lang-key="probabilityTitle"></h3>
            <p data-lang-key="probabilityDesc"></p>
            <table id="probability-table">
                <thead>
                    <tr>
                        <th data-lang-key="rarityHeader"></th>
                        <th data-lang-key="chanceHeader"></th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
  </div>
  
  <audio id="openSound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_73138b32f1.mp3" preload="auto"></audio>
  <audio id="winSound" src="https://cdn.pixabay.com/audio/2022/11/22/audio_74c8f2b1d3.mp3" preload="auto"></audio>
  <audio id="claimSound" src="https://cdn.pixabay.com/audio/2022/03/10/audio_c898992a40.mp3" preload="auto"></audio>
  <audio id="specialWinSound" src="https://cdn.pixabay.com/audio/2022/08/25/audio_51911a3554.mp3" preload="auto"></audio>

  <div id="mainMenuModal" class="modal-overlay">
    <div class="modal-content">
      <button class="close-btn" onclick="closeModal('mainMenuModal')">&times;</button>
      <h2 data-lang-key="mainMenuTitle">Ana Menü</h2>
      <div class="menu-grid">
        <h3 class="menu-category" data-lang-key="menuCategoryProgress"></h3>
        <div class="menu-options">
            <button onclick="openModal('csPathModal')">
                <span class="menu-icon"><svg viewBox="0 0 24 24"><path d="M4 18h16v-2H4v2zm0-5h16v-2H4v2zm0-5h16V6H4v2z"/></svg></span>
                <span class="menu-text" data-lang-key="csPathBtn"></span>
            </button>
            <button onclick="openModal('dailyRewardModal')">
                <span class="menu-icon"><svg viewBox="0 0 24 24"><path d="M20 6h-2.18c.11-.31.18-.65.18-1a3 3 0 0 0-3-3H9a3 3 0 0 0-3 3c0 .35.07.69.18 1H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2zm-8-2h4a1 1 0 0 1 1 1 1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1 1 1 0 0 1 1-1zm8 16H4V8h16v12z"/></svg></span>
                <span class="menu-text" data-lang-key="dailyRewardsBtn"></span>
                <div id="dailyRewardsMenuBtn"></div>
            </button>
            <button onclick="openModal('achievementsModal')">
                <span class="menu-icon"><svg viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87L18.18 21 12 17.77 5.82 21 7 14.14 2 9.27l6.91-1.01L12 2z"/></svg></span>
                <span class="menu-text" data-lang-key="achievementsBtn"></span>
            </button>
            <button onclick="openModal('collectionModal')">
                <span class="menu-icon"><svg viewBox="0 0 24 24"><path d="M22 16V4c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2zm-11-4l2.03 2.71L16 11l4 5H8l3-4zM2 6v14c0 1.1.9 2 2 2h14v-2H4V6H2z"/></svg></span>
                <span class="menu-text" data-lang-key="collectionBtn"></span>
            </button>
        </div>
        
        <h3 class="menu-category" data-lang-key="menuCategoryGameplay"></h3>
        <div class="menu-options">
            <button onclick="openModal('inventoryModal')">
                <span class="menu-icon"><svg viewBox="0 0 24 24"><path d="M20 6h-3.18C16.3 4.24 14.36 3 12 3s-4.3 1.24-4.82 3H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2zm-8 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/></svg></span>
                <span class="menu-text" data-lang-key="inventoryBtn"></span>
            </button>
            <button onclick="openModal('boostShopModal')">
                <span class="menu-icon"><svg viewBox="0 0 24 24"><path d="M11 9h2V6h3V4h-3V1h-2v3H8v2h3v3zm-4 9c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zm10 0c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2zM7.17 14.75l.1.17H16.8l2.92-5.04-1.55-.89L16.8 11H8.53L4.27 2H1v2h2l3.6 7.59L5.25 14c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25z"/></svg></span>
                <span class="menu-text" data-lang-key="boostShopBtn"></span>
            </button>
        </div>
        
        <h3 class="menu-category" data-lang-key="menuCategoryAutomation"></h3>
        <div class="menu-options">
             <button onclick="openModal('autoSellModal')">
                <span class="menu-icon"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-2-9h4v2h-4zm-2-4h8v2H8z"/></svg></span>
                <span class="menu-text" data-lang-key="autoSellSettingsBtn"></span>
            </button>
            <button onclick="openModal('autoOpenModal')">
                <span class="menu-icon"><svg viewBox="0 0 24 24"><path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.08-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49 1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.08.49 0 .61.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/></svg></span>
                <span class="menu-text" data-lang-key="autoOpenBtn"></span>
            </button>
        </div>

        <h3 class="menu-category" data-lang-key="menuCategorySystem"></h3>
        <div class="menu-options">
            <button onclick="openModal('languageSelectModal')">
                <span class="menu-icon"><svg viewBox="0 0 24 24"><path d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"/></svg></span>
                <span class="menu-text" data-lang-key="languageBtn"></span>
            </button>
            <button onclick="openModal('versionPatchesModal')">
                <span class="menu-icon"><svg viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg></span>
                <span class="menu-text" data-lang-key="versionPatchesBtn"></span>
            </button>
            <button onclick="resetGameAndConfirm()">
                <span class="menu-icon"><svg viewBox="0 0 24 24"><path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/></svg></span>
                <span class="menu-text" data-lang-key="resetGameBtn"></span>
            </button>
        </div>
      </div>
    </div>
  </div>

  <div id="inventoryModal" class="modal-overlay">
    <div class="modal-content">
      <button class="close-btn" onclick="closeModal('inventoryModal')">&times;</button>
      <h2 data-lang-key="inventoryTitle">Envanterin</h2>
      <div id="inventory-filters">
        <select id="rarityFilter">
          <option value="all" data-lang-key="allRarities"></option>
          <option value="trash" data-lang-key="trashRarity"></option>
          <option value="common" data-lang-key="commonRarity"></option>
          <option value="uncommon" data-lang-key="uncommonRarity"></option>
          <option value="rare" data-lang-key="rareRarity"></option>
          <option value="epic" data-lang-key="epicRarity"></option>
          <option value="exotic" data-lang-key="exoticRarity"></option>
          <option value="mythic" data-lang-key="mythicRarity"></option>
          <option value="legendary" data-lang-key="legendaryRarity"></option>
          <option value="ancient" data-lang-key="ancientRarity"></option>
          <option value="immortal" data-lang-key="immortalRarity"></option>
          <option value="divine" data-lang-key="divineRarity"></option>
          <option value="chroma" data-lang-key="chromaRarity"></option>
        </select>
        <select id="typeFilter">
          <option value="all" data-lang-key="allTypes"></option>
          <option value="item" data-lang-key="itemType"></option>
          <option value="boost" data-lang-key="boostType"></option>
        </select>
        <button onclick="applyInventoryFilters()" data-lang-key="filterBtn"></button>
        <button onclick="sellAllFilteredItems()" data-lang-key="sellAllFilteredBtn"></button>
      </div>
      <div id="inventory">
        <p id="no-items-message" data-lang-key="noItemsMessage"></p>
      </div>
    </div>
  </div>

  <div id="boostShopModal" class="modal-overlay">
    <div class="modal-content">
      <button class="close-btn" onclick="closeModal('boostShopModal')">&times;</button>
      <h2 data-lang-key="boostShopTitle"></h2>
      <div id="boosts-container">
          <p id="no-boosts-message" style="display: none;" data-lang-key="noBoostsMessage"></p>
      </div>
    </div>
  </div>

  <div id="achievementsModal" class="modal-overlay">
    <div class="modal-content">
      <button class="close-btn" onclick="closeModal('achievementsModal')">&times;</button>
      <h2 data-lang-key="achievementsTitle"></h2>
      <div id="achievements-list">
          <p id="no-achievements-message" style="display: none;" data-lang-key="noAchievementsMessage"></p>
      </div>
    </div>
  </div>

  <div id="itemDetailsModal" class="modal-overlay">
    <div class="modal-content item-details-modal">
        <button class="close-btn" onclick="closeModal('itemDetailsModal')">&times;</button>
        <h3 id="modalItemName"></h3>
        <div class="item-display">
            <img id="modalItemImage" src="" alt="Eşya Resmi">
            <div id="modalItemRarity" class="item-rarity-text"></div>
            <div id="modalItemSellPrice" class="modal-message"></div>
        </div>
        <div class="modal-buttons">
            <button id="sellItemBtn" class="sell-btn" data-lang-key="sellBtn"></button>
            <button id="favoriteItemBtn" class="favorite-btn" data-lang-key="favoriteBtn"></button>
            <button class="close-btn-small" onclick="closeModal('itemDetailsModal')" data-lang-key="closeBtn"></button>
        </div>
        <div id="modalMessage" class="modal-message"></div>
    </div>
  </div>

  <div id="versionPatchesModal" class="modal-overlay">
    <div class="modal-content">
      <button class="close-btn" onclick="closeModal('versionPatchesModal')">&times;</button>
      <h2 data-lang-key="versionPatchesTitle"></h2>
      <ul id="patches-list">
      </ul>
    </div>
  </div>

  <div id="autoSellModal" class="modal-overlay">
    <div class="modal-content">
      <button class="close-btn" onclick="closeModal('autoSellModal')">&times;</button>
      <h2 data-lang-key="autoSellSettingsTitle"></h2>
      <p data-lang-key="autoSellDescription"></p>
      <div id="auto-sell-options">
        <label><input type="checkbox" id="autoSellTrash"> <span data-lang-key="trashRarity"></span></label>
        <label><input type="checkbox" id="autoSellCommon"> <span data-lang-key="commonRarity"></span></label>
        <label><input type="checkbox" id="autoSellUncommon"> <span data-lang-key="uncommonRarity"></span></label>
        <label><input type="checkbox" id="autoSellRare"> <span data-lang-key="rareRarity"></span></label>
        <label><input type="checkbox" id="autoSellEpic"> <span data-lang-key="epicRarity"></span></label>
        <label><input type="checkbox" id="autoSellExotic"> <span data-lang-key="exoticRarity"></span></label>
        <label><input type="checkbox" id="autoSellMythic"> <span data-lang-key="mythicRarity"></span></label>
        <label><input type="checkbox" id="autoSellLegendary"> <span data-lang-key="legendaryRarity"></span></label>
        <label><input type="checkbox" id="autoSellAncient"> <span data-lang-key="ancientRarity"></span></label>
        <label><input type="checkbox" id="autoSellImmortal"> <span data-lang-key="immortalRarity"></span></label>
        <label><input type="checkbox" id="autoSellDivine"> <span data-lang-key="divineRarity"></span></label>
        <label><input type="checkbox" id="autoSellChroma"> <span data-lang-key="chromaRarity"></span></label>
      </div>
      <button id="saveAutoSellBtn" data-lang-key="saveSettingsBtn"></button>
      <div id="auto-sell-status"></div>
    </div>
  </div>

  <div id="autoOpenModal" class="modal-overlay">
    <div class="modal-content">
      <button class="close-btn" onclick="closeModal('autoOpenModal')">&times;</button>
      <h2 data-lang-key="autoOpenTitle"></h2>
      <p id="auto-open-info"></p>
      <div id="auto-open-controls">
        <button id="auto-open-start-btn" data-lang-key="startBtn"></button>
        <button id="auto-open-stop-btn" disabled data-lang-key="stopBtn"></button>
      </div>
      <div id="auto-open-count" data-lang-key="casesOpened"></div>
    </div>
  </div>

  <div id="languageSelectModal" class="modal-overlay">
    <div class="modal-content">
        <button class="close-btn" onclick="closeModal('languageSelectModal')">&times;</button>
        <h2 data-lang-key="languageOptionsTitle"></h2>
        <div id="language-options">
            <button data-lang-code="en" data-lang-key="englishLang"></button>
            <button data-lang-code="tr" data-lang-key="turkishLang"></button>
            <button data-lang-code="ar" data-lang-key="arabicLang"></button>
            <button data-lang-code="de" data-lang-key="germanLang"></button>
            <button data-lang-code="es" data-lang-key="spanishLang"></button>
            <button data-lang-code="az" data-lang-key="azerbaijaniLang"></button>
            <button data-lang-code="ru" data-lang-key="russianLang"></button>
            <button data-lang-code="ja" data-lang-key="japaneseLang"></button>
            <button data-lang-code="ko" data-lang-key="koreanLang"></button>
            <button data-lang-code="hi" data-lang-key="hindiLang"></button>
        </div>
    </div>
  </div>

  <div id="dailyRewardModal" class="modal-overlay">
    <div class="modal-content">
      <button class="close-btn" onclick="closeModal('dailyRewardModal')">&times;</button>
      <h2 data-lang-key="dailyRewardsTitle"></h2>
      <p id="dailyRewardDesc"></p>
      <div id="daily-rewards-grid"></div>
      <p id="daily-reward-message" class="modal-message"></p>
    </div>
  </div>

  <div id="csPathModal" class="modal-overlay">
    <div class="modal-content">
        <button class="close-btn" onclick="closeModal('csPathModal')">&times;</button>
        <h2 data-lang-key="csPathTitle"></h2>
        <p data-lang-key="csPathDesc"></p>
        <div id="cs-path-progress-bar-container">
            <div id="cs-path-progress-bar"></div>
        </div>
        <div id="cs-path-xp-text">XP: 0 / 0</div>
        <div id="cs-path-rewards-list"></div>
    </div>
  </div>
  
  <div id="usernameModal" class="modal-overlay">
      <div class="modal-content">
          <h2 data-lang-key="welcomeTitle"></h2>
          <p data-lang-key="enterUsernamePrompt"></p>
          <div class="form-group">
              <input type="text" id="usernameInput" maxlength="20" placeholder="">
          </div>
          <div class="form-group">
              <button id="saveUsernameBtn" data-lang-key="saveUsernameBtn"></button>
          </div>
      </div>
  </div>

  <div id="adminPanelModal" class="modal-overlay">
      <div class="modal-content">
          <button class="close-btn" onclick="closeModal('adminPanelModal')">&times;</button>
          <h2 data-lang-key="adminPanelTitle"></h2>
          <div class="form-group">
              <label for="adminBalance" data-lang-key="adminAddBalance"></label>
              <input type="number" id="adminBalance" value="10000">
              <button onclick="adminAddBalance()" data-lang-key="adminAddBtn"></button>
          </div>
          <div class="form-group">
              <label for="adminXp" data-lang-key="adminAddXp"></label>
              <input type="number" id="adminXp" value="1000">
              <button onclick="adminAddXp()" data-lang-key="adminAddBtn"></button>
          </div>
          <div class="form-group">
              <label for="adminItem" data-lang-key="adminAddItem"></label>
              <select id="adminItem"></select>
              <button onclick="adminAddItem()" data-lang-key="adminAddBtn"></button>
          </div>
      </div>
  </div>

  <div id="collectionModal" class="modal-overlay">
      <div class="modal-content">
          <button class="close-btn" onclick="closeModal('collectionModal')">&times;</button>
          <h2 data-lang-key="collectionTitle"></h2>
          <p id="collection-progress" data-lang-key="collectionProgress"></p>
          <div id="collection-grid"></div>
      </div>
  </div>

  <div id="specialWinModal" class="modal-overlay">
      <div class="modal-content">
          <h2 id="special-win-title" data-lang-key="specialWinTitle"></h2>
          <div id="special-win-item-container">
              <img id="special-win-item-image" src="" alt="Won Item">
          </div>
          <h3 id="special-win-item-name"></h3>
          <p id="special-win-item-rarity"></p>
      </div>
  </div>

  <div id="quick-access-buttons">
    <button class="quick-access-btn" onclick="openModal('boostShopModal')">
        <span class="quick-icon">
            <svg viewBox="0 0 24 24"><path d="M11 9h2V6h3V4h-3V1h-2v3H8v2h3v3zm-4 9c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zm10 0c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2zM7.17 14.75l.1.17H16.8l2.92-5.04-1.55-.89L16.8 11H8.53L4.27 2H1v2h2l3.6 7.59L5.25 14c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25z"/></svg>
        </span>
    </button>
    <button class="quick-access-btn" onclick="openModal('inventoryModal')">
        <span class="quick-icon">
             <svg viewBox="0 0 24 24"><path d="M20 6h-3.18C16.3 4.24 14.36 3 12 3s-4.3 1.24-4.82 3H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2zm-8 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/></svg>
        </span>
    </button>
    <button class="quick-access-btn" onclick="openModal('achievementsModal')">
        <span class="quick-icon">
             <svg viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87L18.18 21 12 17.77 5.82 21 7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
        </span>
    </button>
  </div>

  <script>
    const translations = {
        en: { lowBalanceSupport: "Low Balance Support! +$100 granted.", loading: "Loading...", menuBtn: "☰ Menu", gameTitle: "🎁 Case Opening Simulator MK", balance: "Balance:", caseCost: "Case Cost:", playerXP: "XP:", openCaseBtn: "Open Case", mainMenuTitle: "Main Menu", inventoryBtn: "Inventory", boostShopBtn: "Boost Shop", achievementsBtn: "Achievements", autoSellSettingsBtn: "Auto-Sell", autoOpenBtn: "Auto-Open", versionPatchesBtn: "Patches", languageBtn: "Language", resetGameBtn: "Reset", dailyRewardsBtn: "Daily", csPathBtn: "CS Path", inventoryTitle: "Your Inventory", allRarities: "All Rarities", trashRarity: "Trash", commonRarity: "Common", uncommonRarity: "Uncommon", rareRarity: "Rare", epicRarity: "Epic", exoticRarity: "Exotic", mythicRarity: "Mythic", legendaryRarity: "Legendary", ancientRarity: "Ancient", immortalRarity: "Immortal", divineRarity: "Divine", chromaRarity: "Chroma", allTypes: "All Types", itemType: "Items", boostType: "Boosts", filterBtn: "Filter", sellAllFilteredBtn: "Sell Filtered", noItemsMessage: "Your inventory is empty. Open a case and win items!", boostShopTitle: "Boost Shop", noBoostsMessage: "No boosts available for purchase at the moment.", achievementsTitle: "Achievements", noAchievementsMessage: "No achievements defined yet.", sellBtn: "Sell", favoriteBtn: "Favorite ⭐", unfavoriteBtn: "Unfavorite ⭐", closeBtn: "Close", autoSellSettingsTitle: "Auto-Sell Settings", autoSellDescription: "Items of selected rarities will be sold automatically upon opening.", saveSettingsBtn: "Save Settings", autoOpenTitle: "Auto-Open Case", startBtn: "Start", stopBtn: "Stop", casesOpened: "Cases Opened:", languageOptionsTitle: "Language Options", englishLang: "English", turkishLang: "Turkish", arabicLang: "العربية", germanLang: "Deutsch", spanishLang: "Español", azerbaijaniLang: "Azərbaycanca", russianLang: "Русский", japaneseLang: "日本語", koreanLang: "한국어", hindiLang: "हिन्दी", youWon: "You Won:", notEnoughBalance: "Insufficient balance! You need ${cost} to open a case.", autoSellStoppedBalance: "Insufficient balance! Auto-opening stopped.", itemSoldAuto: "(Auto-Sold)", itemSold: "{item} sold for ${price}!", itemNotFound: "ERROR: Item not found in inventory!", boostCannotBeSold: "Boost items cannot be sold!", cannotSellFavorite: "You cannot sell a favorite item! Unfavorite it first.", boostAlreadyOwned: "You already own this boost!", boostPurchased: "{boostName} successfully purchased! Boost active!", achievementCompleted: "ACHIEVEMENT UNLOCKED", achievementRewardBalance: "${amount} earned!", achievementRewardBoost: "You won the {boostName} boost and it's active!", achievementBoostAlreadyOwned: "You already own the {boostName} boost.", unknownBoostReward: "Unknown boost reward!", autoSellStatusOff: "Auto-sell is off.", autoSellStatusOn: "Auto-sell rarities: {rarities}", autoOpenMinAchievements: "You need to complete at least 5 achievements to use this feature. Currently {count} achievements completed.", autoOpenStopped: "Auto-opening stopped.", gameSavedError: "An error occurred while saving game data.", gameLoadedError: "An error occurred while loading saved game. A new game has started.", gameReset: "Game has been reset!", filteredItemsSold: "{count} items sold for ${value}!", noFilteredItemsToSell: "No filtered items to sell or all are favorites/boosts.", confirmResetGame: "Are you sure you want to reset all game data? This action cannot be undone!", favoriteAdded: "{item} added to favorites!", favoriteRemoved: "{item} has been removed from favorites!", itemLoadError: "Error: Item could not be loaded", dailyRewardsTitle: "Daily Rewards", dailyRewardDesc: "Log in every day to claim a special reward!", dailyRewardClaimed: "Reward for Day {day} claimed!", dailyRewardAlreadyClaimed: "Today's reward has already been claimed. Come back in:", dailyRewardNotReady: "Today's reward is not available yet.", day: "Day", claimBtn: "Claim", claimedBtn: "Claimed", csPathTitle: "CS Path", csPathDesc: "Earn XP by opening cases and claim rewards as you progress on the path!", tier: "Tier", xpUnit: "XP", reward: "Reward", csPathRewardClaimed: "Reward for Tier {tier} claimed!", dailyCaseLimitReached: "Daily case limit reached ({limit}). Come back tomorrow!", inProgressAchievement: "In Progress", sellLastBtn: "Sell Last Item", noSellableItem: "No sellable item in inventory!", mute: "Mute", unmute: "Unmute", collectionBtn: "Collection", welcomeTitle: "Welcome!", enterUsernamePrompt: "Please start by entering a username.", usernameInputPlaceholder: "Enter your name...", saveUsernameBtn: "Save and Start", adminPanelTitle: "Admin Panel", adminAddBalance: "Add Balance", adminAddXp: "Add XP", adminAddItem: "Add Item", adminAddBtn: "Add", collectionTitle: "Collection", collectionProgress: "Progress:", probabilityTitle: "Probability Table", probabilityDesc: "These are the current item drop rates, including your active boosts.", rarityHeader: "Rarity", chanceHeader: "Chance", globalAnnouncement: "Congratulations {username}, you won a {itemName}!", allItemsCollected: "Congratulations! You have collected all the items!", immortalFinder: "Immortal", immortalFinderDesc: "Obtain an immortal item.", richMan: "Rich Man", richManDesc: "Reach a balance of $1,000,000.", allBoosts: "Booster", allBoostsDesc: "Purchase all available boosts.", caseaholic: "Caseaholic", caseaholicDesc: "Open 500 cases.", elitePlayer: "Elite Player", elitePlayerDesc: "Reach a balance of $100,000.", godTier: "God Tier", godTierDesc: "Find a Chroma item.", xpCollector: "XP Collector", xpCollectorDesc: "Reach 10,000 XP.", luckEventActive: "LUCK EVENT ACTIVE! {multiplier}x drop rate for rare items and above!", luckEventEnds: "Luck event ends in:", luckEventStarts: "Next luck event in:", adeptCollector: "Adept Collector", adeptCollectorDesc: "Collect 50% of all unique items.", somethingInBetween: "Something in Between", somethingInBetweenDesc: "Win an uncommon item.", frugalShopper: "Frugal Shopper", frugalShopperDesc: "Get your case cost below $80.", freeMoneyBtnText: "Claim +$100", freeMoneyClaimed: "+$100 claimed!", menuCategoryProgress: "Progress", menuCategoryGameplay: "Gameplay", menuCategoryAutomation: "Automation", menuCategorySystem: "System", specialWinTitle: "INCREDIBLE DROP!", trashDigger: "Trash Digger", trashDiggerDesc: "Find an item of Trash rarity.", mythSeeker: "Myth Seeker", mythSeekerDesc: "Find a Mythic item.", divinity: "Divinity", divinityDesc: "Find a Divine item.", pennyPincher: "Penny-pincher", pennyPincherDesc: "Use the free money button 10 times.", boostManiac: "Boost Maniac", boostManiacDesc: "Own 10 different boosts.", masterCollector: "Master Collector", masterCollectorDesc: "Collect all unique items in the game." },
        tr: { lowBalanceSupport: "Düşük Bakiye Desteği! +100$ eklendi.", loading: "Yükleniyor...", menuBtn: "☰ Menü", gameTitle: "🎁 Kasa Açma Simülasyonu MK", balance: "Bakiye:", caseCost: "Kasa Maliyeti:", playerXP: "XP:", openCaseBtn: "Kasayı Aç", mainMenuTitle: "Ana Menü", inventoryBtn: "Envanter", boostShopBtn: "Boost Mağazası", achievementsBtn: "Başarımlar", autoSellSettingsBtn: "Oto-Sat", autoOpenBtn: "Oto-Aç", versionPatchesBtn: "Yamalar", languageBtn: "Dil", resetGameBtn: "Sıfırla", dailyRewardsBtn: "Günlük", csPathBtn: "CS Yolu", inventoryTitle: "Envanterin", allRarities: "Tüm Nadirlikler", trashRarity: "Çöp", commonRarity: "Sıradan", uncommonRarity: "Sıradışı", rareRarity: "Nadir", epicRarity: "Destansı", exoticRarity: "Egzotik", mythicRarity: "Mistik", legendaryRarity: "Efsanevi", ancientRarity: "Kadim", immortalRarity: "Ölümsüz", divineRarity: "İlahi", chromaRarity: "Kroma", allTypes: "Tüm Türler", itemType: "Eşyalar", boostType: "Boostlar", filterBtn: "Filtrele", sellAllFilteredBtn: "Filtrelenenleri Sat", noItemsMessage: "Envanterin boş. Bir kasa aç ve eşya kazan!", boostShopTitle: "Boost Mağazası", noBoostsMessage: "Şu anda satın alınabilecek boost yok.", achievementsTitle: "Başarımlar", noAchievementsMessage: "Henüz başarım tanımlanmamış.", sellBtn: "Sat", favoriteBtn: "Favorile ⭐", unfavoriteBtn: "Favoriden Çıkar ⭐", closeBtn: "Kapat", autoSellSettingsTitle: "Otomatik Sat Ayarları", autoSellDescription: "Açtığın eşyaların, seçtiğin nadirlikteki olanları otomatik olarak satılacaktır.", saveSettingsBtn: "Ayarları Kaydet", autoOpenTitle: "Otomatik Kasa Aç", startBtn: "Başlat", stopBtn: "Durdur", casesOpened: "Açılan Kasa:", languageOptionsTitle: "Dil Seçenekleri", englishLang: "English", turkishLang: "Türkçe", arabicLang: "العربية", germanLang: "Deutsch", spanishLang: "Español", azerbaijaniLang: "Azərbaycanca", russianLang: "Русский", japaneseLang: "日本語", koreanLang: "한국어", hindiLang: "हिन्दी", youWon: "Kazandın:", notEnoughBalance: "Yetersiz bakiye! Kasa açmak için {cost}$'a ihtiyacın var.", autoSellStoppedBalance: "Yetersiz bakiye! Otomatik kasa açma durduruldu.", itemSoldAuto: "(Otomatik Satıldı)", itemSold: "{item} {price}$ karşılığında satıldı!", itemNotFound: "HATA: Eşya envanterde bulunamadı!", boostCannotBeSold: "Boost eşyaları satılamaz!", cannotSellFavorite: "Favori bir eşyayı satamazsın! Önce favorilerden çıkar.", boostAlreadyOwned: "Bu boost'a zaten sahipsin!", boostPurchased: "{boostName} başarıyla satın alındı! Boost aktif!", achievementCompleted: "BAŞARIM AÇILDI", achievementRewardBalance: "{amount}$ kazandın!", achievementRewardBoost: "{boostName} boost'unu kazandın ve aktif edildi!", achievementBoostAlreadyOwned: "{boostName} boost'una zaten sahipsin.", unknownBoostReward: "Bilinmeyen bir boost ödülü!", autoSellStatusOff: "Otomatik satma kapalı.", autoSellStatusOn: "Otomatik satılacak nadirlikler: {rarities}", autoOpenMinAchievements: "Bu özelliği kullanmak için en az 5 başarım tamamlamalısın! Şu an {count} başarım tamamlandı.", autoOpenStopped: "Otomatik kasa açma durduruldu.", gameSavedError: "Oyun verileri kaydedilirken bir hata oluştu.", gameLoadedError: "Kayıtlı oyun yüklenirken hata oluştu. Yeni oyun başlatıldı.", gameReset: "Oyun sıfırlandı!", filteredItemsSold: "{count} eşya {value}$ karşılığında satıldı!", noFilteredItemsToSell: "Satılacak filtrelenmiş eşya bulunamadı veya hepsi favori/boost.", confirmResetGame: "Tüm oyun verilerini sıfırlamak istediğine emin misin? Bu işlem geri alınamaz!", favoriteAdded: "{item} favorilere eklendi!", favoriteRemoved: "{item} favorilerden çıkarıldı!", itemLoadError: "Hata: Eşya yüklenemedi", dailyRewardsTitle: "Günlük Ödüller", dailyRewardDesc: "Her gün giriş yaparak özel bir ödül kazan!", dailyRewardClaimed: "{day}. Gün ödülü alındı!", dailyRewardAlreadyClaimed: "Bugünün ödülü zaten alındı. Sonraki ödül için kalan süre:", dailyRewardNotReady: "Bugünün ödülü henüz hazır değil.", day: "Gün", claimBtn: "Al", claimedBtn: "Alındı", csPathTitle: "CS Yolu", csPathDesc: "Kasa açarak XP kazan ve yolda ilerleyerek ödülleri topla!", tier: "Kademe", xpUnit: "XP", reward: "Ödül", csPathRewardClaimed: "{tier}. Kademe ödülü alındı!", dailyCaseLimitReached: "Günlük kasa açma limitine ({limit}) ulaşıldı. Yarın tekrar gel!", inProgressAchievement: "Devam Ediyor", sellLastBtn: "Son Eşyayı Sat", noSellableItem: "Envanterde satılabilir eşya yok!", mute: "Sesi Kapat", unmute: "Sesi Aç", collectionBtn: "Koleksiyon", welcomeTitle: "Oyuna Hoş Geldin!", enterUsernamePrompt: "Lütfen bir kullanıcı adı girerek başla.", usernameInputPlaceholder: "Kullanıcı adını gir...", saveUsernameBtn: "Kaydet ve Başla", adminPanelTitle: "Admin Paneli", adminAddBalance: "Bakiye Ekle", adminAddXp: "XP Ekle", adminAddItem: "Eşya Ekle", adminAddBtn: "Ekle", collectionTitle: "Koleksiyon", collectionProgress: "İlerleme:", probabilityTitle: "Şans Tablosu", probabilityDesc: "Bunlar, mevcut boostlarınla birlikte güncel eşya düşürme oranlarıdır.", rarityHeader: "Nadirlik", chanceHeader: "Şans", globalAnnouncement: "Tebrikler {username}, bir {itemName} kazandı!", allItemsCollected: "Tebrikler! Tüm eşyaları topladın!", immortalFinder: "Ölümsüz", immortalFinderDesc: "Ölümsüz bir eşya elde et.", richMan: "Zengin", richManDesc: "1.000.000$ bakiyeye ulaş.", allBoosts: "Güçlendirici", allBoostsDesc: "Mevcut tüm boostları satın al.", caseaholic: "Kasakolik", caseaholicDesc: "500 kasa aç.", elitePlayer: "Elit Oyuncu", elitePlayerDesc: "100.000$ bakiyeye ulaş.", godTier: "Tanrı Katı", godTierDesc: "Bir Kroma eşyası bul.", xpCollector: "XP Koleksiyoncusu", xpCollectorDesc: "10.000 XP'ye ulaş.", luckEventActive: "ŞANS ETKİNLİĞİ AKTİF! Nadir ve üstü eşyalar için {multiplier}x düşme oranı!", luckEventEnds: "Şans etkinliğinin bitmesine:", luckEventStarts: "Sıradaki şans etkinliği:", adeptCollector: "Usta Koleksiyoncu", adeptCollectorDesc: "Tüm farklı eşyaların %50'sini topla.", somethingInBetween: "Arada Bir Şey", somethingInBetweenDesc: "Sıradışı bir eşya kazan.", frugalShopper: "Tutumlu Alışverişçi", frugalShopperDesc: "Kasa maliyetini 80$'ın altına düşür.", freeMoneyBtnText: "Al +100$", freeMoneyClaimed: "+100$ alındı!", menuCategoryProgress: "İlerleme", menuCategoryGameplay: "Oynanış", menuCategoryAutomation: "Otomasyon", menuCategorySystem: "Sistem", specialWinTitle: "İNANILMAZ EŞYA!", trashDigger: "Çöpçü", trashDiggerDesc: "Çöp nadirliğinde bir eşya bul.", mythSeeker: "Mistik Avcısı", mythSeekerDesc: "Mistik bir eşya bul.", divinity: "Kutsallık", divinityDesc: "İlahi bir eşya bul.", pennyPincher: "Kuruşçu", pennyPincherDesc: "Ücretsiz para butonunu 10 kez kullan.", boostManiac: "Boost Delisi", boostManiacDesc: "10 farklı boost'a sahip ol.", masterCollector: "Usta Koleksiyoncu", masterCollectorDesc: "Oyundaki tüm farklı eşyaları topla." },
    };

    const patchNotesData = [
      {
        version: "V3.0.0",
        text: {
            en: "Mega Update! Added 3 new rarities (Trash, Mythic, Divine), 6 new items, 8 new boosts, and 6 new achievements. Implemented special visual effects for events and high-tier item drops. Added a free money button for low-balance players. Reorganized main menu for clarity and improved responsive design for all devices.",
            tr: "Mega Güncelleme! 3 yeni nadirlik (Çöp, Mistik, İlahi), 6 yeni eşya, 8 yeni boost ve 6 yeni başarım eklendi. Etkinlikler ve yüksek nadirlikteki eşya düşüşleri için özel görsel efektler getirildi. Düşük bakiyeli oyuncular için ücretsiz para butonu eklendi. Ana menü daha anlaşılır olması için yeniden düzenlendi ve tüm cihazlar için duyarlı tasarım iyileştirildi."
        }
      },
      { 
        version: "V2.0.9", 
        text: { 
          en: "UI responsive fixes. Menu buttons re-ordered for better logic. Swapped 'Exotic' and 'Legendary' rarities. Fixed a logic bug in daily rewards. Collection page now sorted by rarity with 'NEW' tags for unseen items.",
          tr: "Arayüz duyarlılık düzeltmeleri. Menü butonları daha iyi bir mantık için yeniden sıralandı. 'Egzotik' ve 'Efsanevi' nadirlikleri yer değiştirdi. Günlük ödüllerdeki bir mantık hatası düzeltildi. Koleksiyon sayfası artık nadirliğe göre sıralanıyor ve görülmemiş eşyalar için 'YENİ' etiketi gösteriliyor."
        }
      },
      { 
        version: "V2.0.8", 
        text: { 
          en: "Menu buttons layout improved. Added a new 'Uncommon' rarity. Added 4 new boosts and 3 new sword items. The event bar now shows a countdown to the next event. Added 3 new achievements.", 
          tr: "Menü butonları düzenlendi. Yeni 'Sıradışı' nadirliği eklendi. 4 yeni boost ve 3 yeni kılıç eşyası eklendi. Etkinlik çubuğu artık sonraki etkinliğe geri sayım gösteriyor. 3 yeni başarım eklendi."
        }
      },
      { 
        version: "V2.0.7", 
        text: { 
          en: "Permanent probability table on the main screen. 5-minute luck event counter at the bottom of the screen. 2 new boosts. Progress bars on the achievements screen. 'Claimed' text over daily rewards.", 
          tr: "Ana ekranda kalıcı şans tablosu. Ekranın altındaki 5 dakikalık şans etkinliği sayacı. 2 yeni boost. Başarımlar ekranında ilerleme çubukları. Günlük ödüllerin üzerinde 'Alındı' yazısı."
        }
      },
    ];
    
    const itemsData = [
      { id: "item_0", type: "knife", name: { en: "Common Knife", tr: "Sıradan Bıçak"}, rarity: "common"},
      { id: "item_1", type: "sword", name: { en: "Rare Sword", tr: "Nadir Kılıç"}, rarity: "rare"},
      { id: "item_2", type: "claw", name: { en: "Epic Dragon Claw", tr: "Destansı Ejderha Pençesi"}, rarity: "epic"},
      { id: "item_3", type: "shield", name: { en: "Legendary Shield", tr: "Efsanevi Kalkan"}, rarity: "legendary"},
      { id: "item_12", type: "gauntlet", name: { en: "Exotic Gauntlets", tr: "Egzotik Eldivenler"}, rarity: "exotic"},
      { id: "item_13", type: "axe", name: { en: "Ancient Soul Render", tr: "Kadim Ruh Keser"}, rarity: "ancient"},
      { id: "item_14", type: "spear", name: { en: "Immortal Spear", tr: "Ölümsüz Mızrak"}, rarity: "immortal" },
      { id: "item_15", type: "bow", name: { en: "Whispering Bow", tr: "Fısıldayan Yay"}, rarity: "epic" },
      { id: "item_16", type: "hammer", name: { en: "World Breaker", tr: "Dünya Kıran"}, rarity: "ancient" },
      { id: "item_17", type: "katana", name: { en: "Rift Edge Katana", tr: "Yarık Kılıcı Katana"}, rarity: "chroma" },
      { id: "item_18", type: "sword", name: { en: "Rusty Sword", tr: "Paslı Kılıç" }, rarity: "common"},
      { id: "item_19", type: "sword", name: { en: "Guard's Sword", tr: "Muhafız Kılıcı" }, rarity: "uncommon"},
      { id: "item_20", type: "sword", name: { en: "Voidblade", tr: "Hiçlikkılıcı" }, rarity: "epic" },
      { id: "item_21", type: "dagger", name: { en: "Bent Dagger", tr: "Eğri Hançer" }, rarity: "trash" },
      { id: "item_22", type: "mace", name: { en: "Spiked Mace", tr: "Dikenli Topuz" }, rarity: "common" },
      { id: "item_23", type: "scythe", name: { en: "Shadow Scythe", tr: "Gölge Tırpan" }, rarity: "epic" },
      { id: "item_24", type: "rapier", name: { en: "Starlight Rapier", tr: "Yıldızışığı Eskrim Kılıcı" }, rarity: "mythic" },
      { id: "item_25", type: "halberd", name: { en: "Celestial Halberd", tr: "Göksel Teber" }, rarity: "divine" },
      { id: "item_26", type: "bottle", name: { en: "Broken Bottle", tr: "Kırık Şişe" }, rarity: "trash" },
    ];
    
    const boostsData = [
        { id: 'luck_1', name: { en: "Luck Boost I", tr: "Şans Güçlendirme I" }, description: { en: "+5% Rare Chance", tr: "+%5 Nadir Şansı" }, price: 500, rarity: "rare", type: "boost", effect: { rarityChance: { rare: 0.05, epic: 0.02 } } },
        { id: 'money_1', name: { en: "Money Efficiency I", tr: "Para Verimliliği I" }, description: { en: "+10% Sell Revenue", tr: "+%10 Satış Geliri" }, price: 750, rarity: "epic", type: "boost", effect: { sellMultiplier: 0.10 } },
        { id: 'cheap_case_1', name: { en: "Cheap Case I", tr: "Ucuz Kasa I" }, description: { en: "-5% Case Cost", tr: "-%5 Kasa Maliyeti" }, price: 1000, rarity: "exotic", type: "boost", effect: { caseCostReduction: 0.05 } },
        { id: 'xp_1', name: { en: "XP Boost I", tr: "XP Takviyesi I" }, description: { en: "+20% XP Gain", tr: "+%20 XP Kazancı" }, price: 1200, rarity: "epic", type: "boost", effect: { xpMultiplier: 0.20 } },
        { id: 'luck_2', name: { en: "Luck Boost II", tr: "Şans Güçlendirme II" }, description: { en: "+3% Legendary Chance", tr: "+%3 Efsanevi Şansı" }, price: 3000, rarity: "legendary", type: "boost", effect: { rarityChance: { legendary: 0.03 } } },
        { id: 'money_2', name: { en: "Money Efficiency II", tr: "Para Verimliliği II" }, description: { en: "+25% Sell Revenue", tr: "+%25 Satış Geliri" }, price: 5000, rarity: "immortal", type: "boost", effect: { sellMultiplier: 0.25 } },
        { id: 'cheap_case_2', name: { en: "Case Discount II", tr: "Kasa İndirimi II" }, description: { en: "-10% Case Cost", tr: "-%10 Kasa Maliyeti" }, price: 15000, rarity: "immortal", type: "boost", effect: { caseCostReduction: 0.10 } },
        { id: 'luck_3', name: { en: "Chroma Charm", tr: "Kroma Tılsımı" }, description: { en: "+0.05% Chroma Chance", tr: "+%0.05 Kroma Şansı" }, price: 250000, rarity: "immortal", type: "boost", effect: { rarityChance: { chroma: 0.0005 } } },
        { id: 'xp_2', name: { en: "XP Boost II", tr: "XP Takviyesi II" }, description: { en: "+50% XP Gain", tr: "+%50 XP Kazancı" }, price: 4000, rarity: "epic", type: "boost", effect: { xpMultiplier: 0.50 } },
        { id: 'uncommon_luck_1', name: { en: "Uncommon Charm", tr: "Sıradışı Tılsımı" }, description: { en: "+10% Uncommon Chance", tr: "+%10 Sıradışı Şansı" }, price: 1000, rarity: "rare", type: "boost", effect: { rarityChance: { uncommon: 0.10 } } },
        { id: 'money_3', name: { en: "Money Efficiency III", tr: "Para Verimliliği III" }, description: { en: "+40% Sell Revenue", tr: "+%40 Satış Geliri" }, price: 10000, rarity: "immortal", type: "boost", effect: { sellMultiplier: 0.40 } },
        { id: 'cheap_case_3', name: { en: "Case Discount III", tr: "Kasa İndirimi III" }, description: { en: "-15% Case Cost", tr: "-%15 Kasa Maliyeti" }, price: 25000, rarity: "immortal", type: "boost", effect: { caseCostReduction: 0.15 } },
        { id: 'luck_uncommon_2', name: { en: "Common Charm", tr: "Sıradan Tılsımı" }, description: { en: "+15% Uncommon Chance", tr: "+%15 Sıradışı Şansı" }, price: 1800, rarity: "rare", type: "boost", effect: { rarityChance: { uncommon: 0.15 } } },
        { id: 'luck_epic_1', name: { en: "Epic Lure", tr: "Destansı Yem" }, description: { en: "+5% Epic Chance", tr: "+%5 Destansı Şansı" }, price: 3500, rarity: "epic", type: "boost", effect: { rarityChance: { epic: 0.05 } } },
        { id: 'xp_3', name: { en: "XP Surge", tr: "XP Patlaması" }, description: { en: "+100% XP Gain", tr: "+%100 XP Kazancı" }, price: 8000, rarity: "legendary", type: "boost", effect: { xpMultiplier: 1.0 } },
        { id: 'money_pro', name: { en: "Golden Touch", tr: "Altın Dokunuş" }, description: { en: "+50% Sell Revenue", tr: "+%50 Satış Geliri" }, price: 12000, rarity: "immortal", type: "boost", effect: { sellMultiplier: 0.50 } },
        { id: 'cost_cutter_pro', name: { en: "Master Haggler", tr: "Usta Pazarlıkçı" }, description: { en: "-20% Case Cost", tr: "-%20 Kasa Maliyeti" }, price: 50000, rarity: "immortal", type: "boost", effect: { caseCostReduction: 0.20 } },
        { id: 'mythic_charm', name: { en: "Mythic Charm", tr: "Mistik Tılsım" }, description: { en: "+1% Mythic Chance", tr: "+%1 Mistik Şansı" }, price: 15000, rarity: "legendary", type: "boost", effect: { rarityChance: { mythic: 0.01 } } },
        { id: 'divine_blessing', name: { en: "Divine Blessing", tr: "İlahi Lütuf" }, description: { en: "+0.05% Divine Chance", tr: "+%0.05 İlahi Şansı" }, price: 100000, rarity: "immortal", type: "boost", effect: { rarityChance: { divine: 0.0005 } } },
        { id: 'auto_seller_plus', name: { en: "Smart Seller", tr: "Akıllı Satıcı" }, description: { en: "+10% Auto-Sell Value", tr: "+%10 Oto-Satış Değeri" }, price: 7500, rarity: "epic", type: "boost", effect: { autoSellMultiplier: 0.10 } }
    ];

    const achievementsData = [
        { id: "first_case", name: { en: "Initiate", tr: "Başlangıç" }, description: { en: "Open your first case.", tr: "İlk kasanı aç." }, target: { caseOpened: 1 }, reward: { type: "balance", amount: 50 } },
        { id: "novice_opener", name: { en: "Novice Opener", tr: "Acemi Kasacı" }, description: { en: "Open 10 cases.", tr: "10 kasa aç." }, target: { caseOpened: 10 }, reward: { type: "balance", amount: 200 } },
        { id: "rare_collector", name: { en: "Rare Finder", tr: "Nadir Avcısı" }, description: { en: "Win a rare item.", tr: "Nadir bir eşya kazan." }, target: { hasRarity: "rare" }, reward: { type: "balance", amount: 150 } },
        { id: "case_opener_master", name: { en: "Case Master", tr: "Usta Kasacı" }, description: { en: "Open 100 cases.", tr: "100 kasa aç." }, target: { caseOpened: 100 }, reward: { type: "balance", amount: 1000 } },
        { id: "caseaholic", name: { en: "Caseaholic", tr: "Kasakolik" }, description: { en: "Open 500 cases.", tr: "500 kasa aç." }, target: { caseOpened: 500 }, reward: { type: "balance", amount: 5000 } },
        { id: "legendary_finder", name: { en: "Legend Hunter", tr: "Efsane Avcısı" }, description: { en: "Win a legendary item.", tr: "Efsanevi bir eşya kazan." }, target: { hasRarity: "legendary" }, reward: { type: "xp", amount: 250 } },
        { id: "millionaire", name: { en: "Millionaire", tr: "Milyoner" }, description: { en: "Earn a total of 10,000$.", tr: "Toplam 10,000$ kazan." }, target: { totalMoneyEarned: 10000 }, reward: { type: "balance", amount: 2000 } },
        { id: "elite_player", name: { en: "Elite Player", tr: "Elit Oyuncu" }, description: { en: "Reach a balance of 100,000$.", tr: "100.000$ bakiyeye ulaş." }, target: { balance: 100000 }, reward: { type: "xp", amount: 2500 } },
        { id: "merchant", name: { en: "Merchant", tr: "Tüccar" }, description: { en: "Sell 10 items.", tr: "10 eşya sat." }, target: { itemsSold: 10 }, reward: { type: "xp", amount: 100 } },
        { id: "collector", name: { en: "Collector", tr: "Koleksiyoncu" }, description: { en: "Have 20 different items in your inventory.", tr: "Envanterinde 20 farklı eşya bulundur." }, target: { inventoryCount: 20 }, reward: { type: "balance", amount: 500 } },
        { id: "immortal_finder", name: { en: "Immortal", tr: "Ölümsüz" }, description: { en: "Obtain an immortal item.", tr: "Ölümsüz bir eşya elde et." }, target: { hasRarity: "immortal" }, reward: { type: "balance", amount: 10000 } },
        { id: "rich_man", name: { en: "Rich Man", tr: "Zengin" }, description: { en: "Reach a balance of 1,000,000$.", tr: "1.000.000$ bakiyeye ulaş." }, target: { balance: 1000000 }, reward: { type: "xp", amount: 5000 } },
        { id: "all_boosts", name: { en: "Booster", tr: "Güçlendirici" }, description: { en: "Purchase all available boosts.", tr: "Mevcut tüm boostları satın al." }, target: { allBoosts: true }, reward: { type: "balance", amount: 2500 } },
        { id: "god_tier", name: { en: "God Tier", tr: "Tanrı Katı" }, description: { en: "Find a Chroma item.", tr: "Bir Kroma eşyası bul." }, target: { hasRarity: "chroma" }, reward: { type: "balance", amount: 50000 }, isRgb: true },
        { id: "xp_collector", name: { en: "XP Collector", tr: "XP Koleksiyoncusu" }, description: { en: "Reach 10,000 XP.", tr: "10.000 XP'ye ulaş." }, target: { xp: 10000 }, reward: { type: "balance", amount: 10000 } },
        { id: "uncommon_finder", name: { en: "Something in Between", tr: "Arada Bir Şey" }, description: { en: "Win an uncommon item.", tr: "Sıradışı bir eşya kazan." }, target: { hasRarity: "uncommon" }, reward: { type: "balance", amount: 250 } },
        { id: "frugal", name: { en: "Frugal Shopper", tr: "Tutumlu Alışverişçi" }, description: { en: "Get your case cost below $80.", tr: "Kasa maliyetini 80$'ın altına düşür." }, target: { caseCost: 80 }, reward: { type: "xp", amount: 500 } },
        { id: "collector_adept", name: { en: "Adept Collector", tr: "Usta Koleksiyoncu" }, description: { en: "Collect 50% of all unique items.", tr: "Tüm farklı eşyaların %50'sini topla." }, target: { collectionProgress: 0.5 }, reward: { type: "balance", amount: 2500 } },
        { id: "trash_digger", name: { en: "Trash Digger", tr: "Çöpçü" }, description: { en: "Find an item of Trash rarity.", tr: "Çöp nadirliğinde bir eşya bul." }, target: { hasRarity: "trash" }, reward: { type: "xp", amount: 5 } },
        { id: "myth_seeker", name: { en: "Myth Seeker", tr: "Mistik Avcısı" }, description: { en: "Find a Mythic item.", tr: "Mistik bir eşya bul." }, target: { hasRarity: "mythic" }, reward: { type: "balance", amount: 1500 } },
        { id: "divinity", name: { en: "Divinity", tr: "Kutsallık" }, description: { en: "Find a Divine item.", tr: "İlahi bir eşya bul." }, target: { hasRarity: "divine" }, reward: { type: "xp", amount: 10000 }, isRgb: true },
        { id: "penny_pincher", name: { en: "Penny-pincher", tr: "Kuruşçu" }, description: { en: "Use the free money button 10 times.", tr: "Ücretsiz para butonunu 10 kez kullan." }, target: { freeMoneyClaims: 10 }, reward: { type: "balance", amount: 500 } },
        { id: "boost_maniac", name: { en: "Boost Maniac", tr: "Boost Delisi" }, description: { en: "Own 10 different boosts.", tr: "10 farklı boost'a sahip ol." }, target: { ownedBoosts: 10 }, reward: { type: "xp", amount: 1000 } },
        { id: "master_collector", name: { en: "Master Collector", tr: "Usta Koleksiyoncu" }, description: { en: "Collect all unique items in the game.", tr: "Oyundaki tüm farklı eşyaları topla." }, target: { collectionProgress: 1.0 }, reward: { type: "balance", amount: 100000 }, isRgb: true }
    ];

    const dailyRewardsData = [
        { day: 1, type: "balance", amount: 500, name: {en: "500 Balance", tr: "500 Bakiye"} },
        { day: 2, type: "item", itemId: "item_19", name: {en: "Guard's Sword", tr: "Muhafız Kılıcı"} },
        { day: 3, type: "balance", amount: 1500, name: {en: "1500 Balance", tr: "1500 Bakiye"} },
        { day: 4, type: "xp", amount: 50, name: {en: "50 XP", tr: "50 XP"} },
        { day: 5, type: "boost", boostId: "luck_1", name: {en: "Luck Boost I", tr: "Şans Güçlendirme I"} },
        { day: 6, type: "balance", amount: 5000, name: {en: "5000 Balance", tr: "5000 Bakiye"} },
        { day: 7, type: "item", itemId: "item_2", name: {en: "Epic Dragon Claw", tr: "Destansı Ejderha Pençesi"} },
    ];
    
    const csPathData = [
        { tier: 1, xp: 1000, reward: { type: "balance", amount: 250 } },
        { tier: 2, xp: 2500, reward: { type: "item", itemId: "item_0" } },
        { tier: 3, xp: 5000, reward: { type: "balance", amount: 1000 } },
        { tier: 4, xp: 7500, reward: { type: "boost", boostId: "xp_1" } },
        { tier: 5, xp: 10000, reward: { type: "balance", amount: 5000 } },
        { tier: 6, xp: 15000, reward: { type: "item", itemId: "item_15" } },
        { tier: 7, xp: 20000, reward: { type: "boost", boostId: "luck_2" } },
        { tier: 8, xp: 30000, reward: { type: "item", itemId: "item_16" } },
    ];
    
    const dom = {
        body: document.getElementById('body'),
        preloader: document.getElementById("preloader"),
        items: document.getElementById("items"),
        result: document.getElementById("result"),
        openBtn: document.getElementById("openBtn"),
        balanceAmount: document.getElementById("balance-amount"),
        xpAmount: document.getElementById("xp-amount"),
        caseCost: document.getElementById("cost-amount"),
        inventory: document.getElementById("inventory"),
        noItemsMessage: document.getElementById("no-items-message"),
        errorMessage: document.getElementById("errorMessage"),
        currentTime: document.getElementById("current-time"),
        modalItemName: document.getElementById("modalItemName"),
        modalItemImage: document.getElementById("modalItemImage"),
        modalItemRarity: document.getElementById("modalItemRarity"),
        modalItemSellPrice: document.getElementById("modalItemSellPrice"),
        modalMessage: document.getElementById("modalMessage"),
        sellItemBtn: document.getElementById("sellItemBtn"),
        favoriteItemBtn: document.getElementById("favoriteItemBtn"),
        patchesList: document.getElementById("patches-list"),
        boostsContainer: document.getElementById("boosts-container"),
        noBoostsMessage: document.getElementById("no-boosts-message"),
        achievementsList: document.getElementById("achievements-list"),
        noAchievementsMessage: document.getElementById("no-achievements-message"),
        dailyRewardsMenuBtn: document.getElementById("dailyRewardsMenuBtn"),
        dailyRewardsGrid: document.getElementById("daily-rewards-grid"),
        dailyRewardMessage: document.getElementById("daily-reward-message"),
        dailyRewardDesc: document.getElementById("dailyRewardDesc"),
        csPathRewardsList: document.getElementById("cs-path-rewards-list"),
        csPathProgressBar: document.getElementById("cs-path-progress-bar"),
        csPathXpText: document.getElementById("cs-path-xp-text"),
        rarityFilter: document.getElementById("rarityFilter"),
        typeFilter: document.getElementById("typeFilter"),
        autoSellCheckboxes: Object.fromEntries(["trash", "common", "uncommon", "rare", "epic", "exotic", "mythic", "legendary", "ancient", "immortal", "divine", "chroma"].map(r => [r, document.getElementById(`autoSell${r.charAt(0).toUpperCase() + r.slice(1)}`)])),
        saveAutoSellBtn: document.getElementById("saveAutoSellBtn"),
        autoSellStatus: document.getElementById("auto-sell-status"),
        autoOpenInfo: document.getElementById("auto-open-info"),
        autoOpenStartBtn: document.getElementById("auto-open-start-btn"),
        autoOpenStopBtn: document.getElementById("auto-open-stop-btn"),
        autoOpenCount: document.getElementById("auto-open-count"),
        sellLastBtn: document.getElementById("sellLastBtn"),
        muteBtn: document.getElementById("muteBtn"),
        muteIconContainer: document.getElementById("muteIconContainer"),
        achievementToast: document.getElementById("achievement-toast"),
        toastTitle: document.getElementById("toast-title"),
        toastDesc: document.getElementById("toast-desc"),
        caseContainer: document.getElementById("case"),
        usernameModal: document.getElementById("usernameModal"),
        usernameInput: document.getElementById("usernameInput"),
        saveUsernameBtn: document.getElementById("saveUsernameBtn"),
        globalAnnouncement: document.getElementById("global-announcement"),
        collectionGrid: document.getElementById("collection-grid"),
        collectionProgress: document.getElementById("collection-progress"),
        probabilityTableBody: document.querySelector("#probability-table tbody"),
        adminItemSelect: document.getElementById("adminItem"),
        userProfileDisplay: document.getElementById("user-profile-display"),
        profileAvatar: document.getElementById("profile-avatar"),
        profileUsername: document.getElementById("profile-username"),
        autoOpenToggleContainer: document.getElementById("autoOpenToggleContainer"),
        autoOpenToggle: document.getElementById("autoOpenToggle"),
        eventTimerBar: document.getElementById("event-timer-bar"),
        freeMoneyBtn: document.getElementById("freeMoneyBtn"),
        specialWinModal: document.getElementById("specialWinModal"),
        specialWinTitle: document.getElementById("special-win-title"),
        specialWinItemImage: document.getElementById("special-win-item-image"),
        specialWinItemName: document.getElementById("special-win-item-name"),
        specialWinItemRarity: document.getElementById("special-win-item-rarity"),
    };

    const sfx = {
        open: document.getElementById("openSound"),
        win: document.getElementById("winSound"),
        claim: document.getElementById("claimSound"),
        specialWin: document.getElementById("specialWinSound"),
    };
    
    const svgIcons = {
        volumeOn: `<svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>`,
        volumeOff: `<svg viewBox="0 0 24 24"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/></svg>`
    };

    let currentLang, currentBalance, currentCaseCost, inventory, nextItemId;
    let playerStats, autoSellRarities, autoOpenInterval, autoOpenedCases;
    let currentModalItem = null;
    let lastWonItem = null;
    let mainGameLoopInterval = null; 

    const baseCaseCost = 100;
    const DAILY_CASE_LIMIT = 5000;
    const XP_PER_CASE = 10;
    const raritySellPrices = { trash: 1, common: 10, uncommon: 25, rare: 50, epic: 200, exotic: 1000, mythic: 2500, legendary: 5000, ancient: 15000, immortal: 50000, divine: 100000, chroma: 250000 };
    const rarityColors = { trash: '#61412C', common: '#A9A9A9', uncommon: '#48bb78', rare: '#4299e1', epic: '#805ad5', exotic: '#ed8936', mythic: '#00A3A3', legendary: '#cbd5e0', ancient: '#e53e3e', immortal: '#FFD700', divine: '#FFFACD', chroma: 'rgb(255,0,0)' };
    const rarityOrder = { trash: 0, common: 1, uncommon: 2, rare: 3, epic: 4, exotic: 5, mythic: 6, legendary: 7, ancient: 8, immortal: 9, divine: 10, chroma: 11 };
    let rarityWeights, baseRarityWeights = { trash: 0.25, common: 0.30, uncommon: 0.20, rare: 0.15, epic: 0.06, exotic: 0.02, mythic: 0.01, legendary: 0.005, ancient: 0.003, immortal: 0.001, divine: 0.0005, chroma: 0.0005 };
    const ADMIN_PASSWORD = "admin123";

    function getSVGDataURI(svgString) {
        return 'data:image/svg+xml;base64,' + btoa(svgString);
    }
    
    function generateItemSVG(rarity, itemType) {
        const color = rarityColors[rarity] || '#ffffff';
        const glow = rarityOrder[rarity] >= rarityOrder.exotic;
        let shape;

        switch(itemType) {
            case 'knife': shape = `<path d="M20 4L5 19l-1-1L19 3z M5 19l-2 2 3 3 2-2z" stroke-width="2" stroke="${color}" fill="none"/>`; break;
            case 'sword': shape = `<path d="M21 3L3 21h-2v-2L19 1h2v2z M5 16L2 19" stroke-width="2" stroke="${color}" fill="none"/>`; break;
            case 'shield': shape = `<path d="M12 2L4 5v6c0 5.55 3.58 10.4 8 11.92 4.42-1.52 8-6.37 8-11.92V5l-8-3z" stroke-width="2" stroke="${color}" fill="${color}40"/>`; break;
            case 'claw': shape = `<path d="M10 3L4 9 9 14l-2 5 5-2 5-5L12 7z" stroke-width="2" stroke="${color}" fill="${color}60"/> <path d="M15 4l5 5" stroke-width="2" stroke="${color}" fill="none"/>`; break;
            case 'gauntlet': shape = `<path d="M18 8V4H8v12h4v4h6v-8h-6V8h6z" stroke-width="2" stroke="${color}" fill="${color}20"/>`; break;
            case 'axe': shape = `<path d="M12 2l10 10-2 2-8-8-8 8-2-2L12 2z M4 14v8h2v-6l2-2" stroke-width="2" stroke="${color}" fill="${color}50"/>`; break;
            case 'spear': shape = `<path d="M12 2l4 8h-8z M12 10v12" stroke-width="2" stroke="${color}" fill="${color}60"/>`; break;
            case 'bow': shape = `<path d="M4 12C4 6 10 2 20 4" stroke-width="2" stroke="${color}" fill="none"/> <path d="M4 12C4 18 10 22 20 20" stroke-width="2" stroke="${color}" fill="none"/> <line x1="4" y1="12" x2="18" y2="12" stroke-width="1.5" stroke="${color}"/>`; break;
            case 'hammer': shape = `<rect x="2" y="4" width="20" height="8" rx="2" stroke-width="2" stroke="${color}" fill="${color}50"/> <line x1="12" y1="12" x2="12" y2="22" stroke-width="3" stroke="${color}"/>`; break;
            case 'katana': shape = `<path d="M4 20L20 4l-1-1-1 1-14 14-1 1 1 1z" stroke-width="1.5" stroke="${color}" fill="${color}40"/> <path d="M6 18l-3 3h2l2-2" stroke-width="1.5" stroke="${color}" fill="none"/>`; break;
            case 'dagger': shape = `<path d="M12 2L9 9h6L12 2z M11 10v12h2V10h-2z" stroke-width="1.5" stroke="${color}" fill="${color}50"/>`; break;
            case 'mace': shape = `<circle cx="12" cy="7" r="5" stroke-width="2" stroke="${color}" fill="${color}40"/><line x1="12" y1="12" x2="12" y2="22" stroke-width="3" stroke="${color}"/>`; break;
            case 'scythe': shape = `<path d="M20 4c-4 4-8 4-12 0L4 8c4 4 4 8 0 12" stroke-width="2" stroke="${color}" fill="none"/><line x1="8" y1="4" x2="4" y2="20" stroke-width="2" stroke="${color}"/>`; break;
            case 'rapier': shape = `<path d="M4 20L20 4" stroke-width="1.5" stroke="${color}" fill="none"/><path d="M4 16h4v4h-4z" stroke-width="1.5" stroke="${color}" fill="${color}30"/>`; break;
            case 'halberd': shape = `<path d="M4 4h10l6 6-6 6H4V4z M14 10H4" stroke-width="1.5" stroke="${color}" fill="${color}40"/><line x1="10" y1="10" x2="10" y2="22" stroke-width="3" stroke="${color}"/>`; break;
            case 'bottle': shape = `<path d="M10 2h4v6l-4 2v10h4v2H6v-2h4V10L6 8V2z" stroke-width="1.5" stroke="${color}" fill="none" stroke-dasharray="3 3"/>`; break;
            default: shape = `<circle cx="12" cy="12" r="10" stroke-width="2" stroke="${color}" fill="none"/>`;
        }

        const svg = `
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="100" height="100">
                ${glow ? `<filter id="glow"><feGaussianBlur stdDeviation="1.5" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>` : ''}
                <g ${glow ? `filter="url(#glow)"` : ''}>${shape}</g>
            </svg>
        `;
        return getSVGDataURI(svg);
    }

    function translateText(key, replacements = {}) {
        let text = (translations[currentLang]?.[key]) 
                   || (translations['en']?.[key]) 
                   || key;
        for (const placeholder in replacements) {
            text = text.replace(`{${placeholder}}`, replacements[placeholder]);
        }
        return text;
    }
    
    function getTranslatedTextFromObject(textObject) {
        if (!textObject) return '';
        return textObject[currentLang] || textObject['en'] || Object.values(textObject)[0] ||'';
    }
    
    function openModal(modalId) {
        const modal = document.getElementById(modalId);
        if(!modal) return;
        
        const modalActions = {
            inventoryModal: applyInventoryFilters,
            boostShopModal: populateBoostShop,
            achievementsModal: renderAchievements,
            autoSellModal: loadAutoSellSettings,
            autoOpenModal: updateAutoOpenInfo,
            languageSelectModal: updateLanguageButtons,
            dailyRewardModal: updateDailyRewardsUI,
            csPathModal: updateCsPathUI,
            collectionModal: () => {
                renderCollection();
                playerStats.newlyCollectedItems = [];
                saveGameData(); // Save the fact that "new" items have been seen
            }
        };
        
        modalActions[modalId]?.();
        modal.classList.add('show');
    }

    function closeModal(modalId) {
        document.getElementById(modalId)?.classList.remove('show');
        if (modalId === 'itemDetailsModal') currentModalItem = null;
    }
    
    function checkAndAddNewlyCollected(itemId) {
        if (!playerStats.collection[itemId]) {
            if (!playerStats.newlyCollectedItems.includes(itemId)) {
                playerStats.newlyCollectedItems.push(itemId);
            }
        }
    }
    
    function getRandomItemByRarity() {
        const rand = Math.random();
        let cumulativeWeight = 0;
        for (const rarity in rarityWeights) {
            cumulativeWeight += rarityWeights[rarity];
            if (rand < cumulativeWeight) {
                const filteredItems = itemsData.filter(item => item.rarity === rarity);
                return filteredItems.length > 0 ? filteredItems[Math.floor(Math.random() * filteredItems.length)] : itemsData[0];
            }
        }
        return itemsData[0];
    }
    
    function calculateSellPrice(item) {
        if (!item || item.type === "boost") return 0;
        let price = raritySellPrices[item.rarity] || 0;
        let sellMultiplier = 1.0;
        inventory.filter(i => i.type === "boost" && i.effect?.sellMultiplier)
                 .forEach(boost => sellMultiplier += boost.effect.sellMultiplier);
        return Math.floor(price * sellMultiplier);
    }
    
    async function openCase(isAuto = false) {
        if (dom.openBtn.disabled && !isAuto) return;
        if (currentBalance < currentCaseCost) {
            showErrorMessage(isAuto ? "autoSellStoppedBalance" : "notEnoughBalance", 3000, { cost: Math.round(currentCaseCost) });
            if (isAuto) stopAutoOpen();
            return;
        }

        const today = new Date().toDateString();
        if(playerStats.lastCaseOpenDate !== today) {
            playerStats.casesOpenedToday = 0;
            playerStats.lastCaseOpenDate = today;
        }
        if (playerStats.casesOpenedToday >= DAILY_CASE_LIMIT) {
            showErrorMessage('dailyCaseLimitReached', 5000, { limit: DAILY_CASE_LIMIT });
            if (isAuto) stopAutoOpen();
            return;
        }
        
        dom.openBtn.disabled = true;
        dom.sellLastBtn.disabled = true;
        sfx.open.currentTime=0; sfx.open.play();
        currentBalance -= currentCaseCost;

        if (currentBalance < 100 && currentBalance >= 0) {
            currentBalance += 100;
            showErrorMessage('lowBalanceSupport', 4000, {}, true); 
        }
        
        let xpGained = XP_PER_CASE;
        inventory.filter(i => i.type === "boost" && i.effect?.xpMultiplier)
                 .forEach(boost => xpGained *= (1 + boost.effect.xpMultiplier));
        
        playerStats.caseOpened++;
        playerStats.casesOpenedToday++;
        playerStats.xp += Math.round(xpGained);
        
        const wonItemData = getRandomItemByRarity(); 
        
        dom.items.innerHTML = '';
        dom.items.style.transition = "none";
        dom.items.style.transform = "translateX(0)";
        void dom.items.offsetWidth;

        const numItems = 100;
        const winIndex = 80;
        for (let i = 0; i < numItems; i++) {
            const item = (i === winIndex) ? wonItemData : getRandomItemByRarity();
            dom.items.appendChild(createItemElement(item));
        }

        const itemFullWidth = dom.items.children[0].offsetWidth + (parseFloat(getComputedStyle(dom.items.children[0]).marginLeft) * 2);
        const scrollAmount = (winIndex * itemFullWidth) - (dom.caseContainer.offsetWidth / 2) + (itemFullWidth / 2);

        dom.items.style.transition = `transform 3.5s cubic-bezier(0.25, 1, 0.5, 1)`;
        dom.items.style.transform = `translateX(-${scrollAmount}px)`;
        
        await new Promise(resolve => setTimeout(resolve, 3550));

        // After reel animation
        const isSpecialWin = rarityOrder[wonItemData.rarity] >= rarityOrder.ancient;
        if (isSpecialWin) {
            await showSpecialWin(wonItemData);
        } else {
            dom.items.children[winIndex].classList.add('highlighted');
            const wonItemName = getTranslatedTextFromObject(wonItemData.name);
            dom.result.innerHTML = `${translateText('youWon')} <span class="${wonItemData.rarity} highlight">${wonItemName}</span>`;
            sfx.win.currentTime=0; sfx.win.play();
        }

        playerStats.raritiesWon[wonItemData.rarity] = true;
        checkAndAddNewlyCollected(wonItemData.id);
        playerStats.collection[wonItemData.id] = true; 

        if (rarityOrder[wonItemData.rarity] >= rarityOrder.exotic) {
            showGlobalAnnouncement(playerStats.username, wonItemData);
        }

        if (autoSellRarities.includes(wonItemData.rarity)) {
            let sellPrice = calculateSellPrice(wonItemData);
            const autoSellBoost = inventory.find(b => b.id === 'auto_seller_plus');
            if (autoSellBoost && autoSellBoost.effect?.autoSellMultiplier) {
                sellPrice *= (1 + autoSellBoost.effect.autoSellMultiplier);
                sellPrice = Math.floor(sellPrice);
            }

            currentBalance += sellPrice;
            playerStats.totalMoneyEarned += sellPrice;
            playerStats.itemsSold++;
            dom.result.innerHTML += `<br><span style="color:#00ff99;">(+${sellPrice}$) ${translateText('itemSoldAuto')}</span>`;
            lastWonItem = null;
        } else {
            const newItem = { ...wonItemData, internalId: nextItemId++, type: "item", isFavorite: false };
            inventory.push(newItem);
            lastWonItem = newItem;
            dom.sellLastBtn.disabled = false;
        }
        
        updateUI();
        checkAchievements(); 
        updateCsPathUI();
        if(!isAuto) dom.openBtn.disabled = false;
    }

    function createItemElement(itemData, isCollection = false) {
        const el = document.createElement("div");
        el.className = `item ${itemData.rarity}`;
        if (isCollection) {
            el.classList.add('collection-item');
            if (playerStats.collection[itemData.id]) {
                el.classList.add('found');
            }
             if (playerStats.newlyCollectedItems.includes(itemData.id)) {
                el.classList.add('new-item');
            }
        }
        el.innerHTML = `
            <img src="${generateItemSVG(itemData.rarity, itemData.type)}" alt="${getTranslatedTextFromObject(itemData.name)}" loading="lazy">
            <div class="item-name">${getTranslatedTextFromObject(itemData.name)}</div>
        `;
        return el;
    }

    function createInventoryItemElement(item) {
        const el = document.createElement("div");
        const itemName = getTranslatedTextFromObject(item.name);
        const itemClass = item.type === "boost" ? `boost-item inventory-item ${item.rarity}-boost` : `inventory-item ${item.rarity}`;
        el.className = itemClass + (item.isFavorite ? ' favorite' : '');
        el.dataset.internalId = item.internalId;
        el.innerHTML = `
            <img src="${generateItemSVG(item.rarity, item.type)}" alt="${itemName}">
            <div class="item-name inventory-item-name">${itemName}</div>
            ${item.isFavorite ? '<span class="favorite-star">⭐</span>' : ''}
        `;
        el.addEventListener('click', () => openItemDetailsModal(item));
        return el;
    }

    function updateInventory(filteredInv = inventory) {
        dom.inventory.innerHTML = '';
        dom.noItemsMessage.style.display = filteredInv.length === 0 ? 'block' : 'none';
        
        filteredInv.sort((a, b) => {
            if (a.isFavorite !== b.isFavorite) return b.isFavorite ? -1 : 1;
            if (a.type !== b.type) return a.type === 'boost' ? -1 : 1;
            return (rarityOrder[b.rarity] || 0) - (rarityOrder[a.rarity] || 0);
        }).forEach(item => dom.inventory.appendChild(createInventoryItemElement(item)));
    }

    function renderAchievements() {
        dom.achievementsList.innerHTML = '';
        if (!achievementsData || achievementsData.length === 0) {
            dom.noAchievementsMessage.style.display = 'block';
            return;
        }
        dom.noAchievementsMessage.style.display = 'none';

        achievementsData.forEach(ach => {
            const achProgress = playerStats.achievements.find(pa => pa.id === ach.id);
            const isCompleted = achProgress?.completed;
            const achEl = document.createElement("div");
            achEl.className = `achievement-item ${isCompleted ? 'completed' : ''} ${isCompleted && ach.isRgb ? 'rgb-achievement' : ''}`;
            
            let rewardText = "";
            const reward = ach.reward;
            if (reward.type === "balance") rewardText = `${translateText('reward')}: ${reward.amount}$`;
            else if (reward.type === "xp") rewardText = `${translateText('reward')}: ${reward.amount} XP`;
            else if (reward.type === "boost") {
                const boost = boostsData.find(b => b.id === reward.boostId);
                rewardText = `${translateText('reward')}: ${boost ? getTranslatedTextFromObject(boost.name) : ''}`;
            }

            let progressHTML = '';
            if (!isCompleted) {
                const targetKey = Object.keys(ach.target)[0];
                const targetValue = ach.target[targetKey];
                let currentValue = 0;
                let maxValue = targetValue;

                switch (targetKey) {
                    case 'caseOpened': currentValue = playerStats.caseOpened; break;
                    case 'totalMoneyEarned': currentValue = playerStats.totalMoneyEarned; break;
                    case 'balance': currentValue = currentBalance; break;
                    case 'xp': currentValue = playerStats.xp; break;
                    case 'itemsSold': currentValue = playerStats.itemsSold; break;
                    case 'inventoryCount': currentValue = inventory.filter(i => i.type === 'item').length; break;
                    case 'caseCost': 
                        currentValue = currentCaseCost; 
                        maxValue = targetValue; 
                        currentValue = baseCaseCost - currentValue;
                        maxValue = baseCaseCost - maxValue;
                        break;
                    case 'collectionProgress':
                         currentValue = Object.keys(playerStats.collection).filter(id => playerStats.collection[id]).length;
                         maxValue = Math.ceil(itemsData.length * targetValue);
                         break;
                    case 'freeMoneyClaims': currentValue = playerStats.freeMoneyClaims || 0; break;
                    case 'ownedBoosts': currentValue = inventory.filter(i => i.type === 'boost').length; break;
                }
                
                if (typeof targetValue === 'number') {
                    const percentage = maxValue > 0 ? Math.min((currentValue / maxValue) * 100, 100) : 0;
                    progressHTML = `
                        <div class="achievement-progress">
                            <div class="achievement-progress-container">
                                <div class="achievement-progress-bar" style="width: ${percentage}%;"></div>
                            </div>
                            <div class="achievement-progress-text">${(targetKey === 'caseCost' ? `$${currentCaseCost.toFixed(2)}` : Math.floor(currentValue))} / ${(targetKey === 'caseCost' ? `<$${ach.target[targetKey]}` : maxValue)}</div>
                        </div>
                    `;
                }
            }
            achEl.innerHTML = `
                <h4>${getTranslatedTextFromObject(ach.name) || translateText(ach.id)}</h4>
                <p>${getTranslatedTextFromObject(ach.description) || translateText(ach.id + 'Desc')}</p>
                <div class="reward-text">${rewardText}</div>
                ${progressHTML}
                <div class="completion-status">${translateText(isCompleted ? 'claimedBtn' : 'inProgressAchievement')}</div>
            `;
            dom.achievementsList.appendChild(achEl);
        });
    }
    
    function updatePatchNotes() {
        dom.patchesList.innerHTML = patchNotesData
            .map(p => `<li><strong>${p.version}:</strong> ${getTranslatedTextFromObject(p.text)}</li>`)
            .join('');
    }

    function applyBoostEffects() {
        const now = new Date();
        const eventData = playerStats.luckEvent;
        let eventMultiplier = 1;
        
        if (eventData && now < new Date(eventData.endTime)) {
            eventMultiplier = eventData.multiplier;
        }

        rarityWeights = { ...baseRarityWeights };
        if (eventMultiplier > 1) {
            for (const r in rarityWeights) {
                if (rarityOrder[r] > rarityOrder.uncommon) { 
                    rarityWeights[r] *= eventMultiplier;
                }
            }
        }

        currentCaseCost = baseCaseCost;
        const activeBoosts = inventory.filter(item => item.type === "boost");
        activeBoosts.forEach(source => {
            if (source.effect?.rarityChance) {
                for (const rarity in source.effect.rarityChance) {
                    if (rarityWeights[rarity] !== undefined) rarityWeights[rarity] += source.effect.rarityChance[rarity];
                }
            }
            if (source.effect?.caseCostReduction) currentCaseCost *= (1 - source.effect.caseCostReduction);
        });
        
        let totalWeight = 0;
        for (const r in rarityWeights) {
            totalWeight += rarityWeights[r];
        }
        
        if (totalWeight > 0) {
           for (const r in rarityWeights) {
               rarityWeights[r] /= totalWeight;
           }
        }
        
        dom.caseCost.textContent = Math.round(currentCaseCost);
        renderProbabilityTable();
    }
    
    function applyInventoryFilters() {
        const rarity = dom.rarityFilter.value;
        const type = dom.typeFilter.value;
        const filtered = inventory.filter(item => 
            (rarity === 'all' || item.rarity === rarity) && (type === 'all' || item.type === type)
        );
        updateInventory(filtered);
    }
    
    function loadAutoSellSettings() {
        Object.keys(dom.autoSellCheckboxes).forEach(r => {
            const checkbox = dom.autoSellCheckboxes[r];
            if (checkbox) checkbox.checked = autoSellRarities.includes(r);
        });
        updateAutoSellStatus();
    }
    function saveAutoSellSettings() {
        autoSellRarities = Object.keys(dom.autoSellCheckboxes).filter(r => dom.autoSellCheckboxes[r]?.checked);
        saveGameData();
        updateAutoSellStatus();
        showErrorMessage("saveSettingsBtn", 3000, {}, true);
    }
    function updateAutoSellStatus() {
        const rarities = autoSellRarities.map(r => translateText(`${r}Rarity`)).join(', ');
        dom.autoSellStatus.textContent = autoSellRarities.length === 0 
            ? translateText("autoSellStatusOff") 
            : translateText("autoSellStatusOn", { rarities });
        dom.autoSellStatus.style.color = autoSellRarities.length > 0 ? "#00ff99" : "#ccc";
    }

    function updateDailyRewardsUI(isInitial = false) {
        if (!isInitial) {
             clearInterval(mainGameLoopInterval); // Stop the timer if it was running
             mainGameLoopInterval = setInterval(gameLoop, 1000);
        }
        dom.dailyRewardsGrid.innerHTML = '';
        dom.dailyRewardMessage.textContent = '';
        const today = new Date().toDateString();
        const claimAvailable = playerStats.lastClaimDate !== today;

        dom.dailyRewardDesc.textContent = translateText('dailyRewardDesc');

        if (!claimAvailable) {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(0, 0, 0, 0);

            const now = new Date();
            const diff = tomorrow.getTime() - now.getTime();
            if (diff > 0) {
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                dom.dailyRewardMessage.textContent = `${translateText('dailyRewardAlreadyClaimed')} ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        dailyRewardsData.forEach((reward, index) => {
            const rewardEl = document.createElement('div');
            rewardEl.className = 'daily-reward-item';
            const dayIndex = index + 1;
            
            const isCurrentClaimableDay = playerStats.dailyRewardCycle % dailyRewardsData.length === index;
            const lastClaimedCycle = playerStats.dailyRewardCycle > 0 ? playerStats.dailyRewardCycle - 1 : dailyRewardsData.length -1;
            const isLastClaimedDay = lastClaimedCycle % dailyRewardsData.length === index;

            let previewHTML = '';
            if (reward.type === 'balance') previewHTML = `<span>${reward.amount}$</span>`;
            else if (reward.type === 'xp') previewHTML = `<span style="color:#8a2be2;">${reward.amount}XP</span>`;
            else if (reward.type === 'item') {
                const item = itemsData.find(i => i.id === reward.itemId);
                if (item) previewHTML = `<img src="${generateItemSVG(item.rarity, item.type)}" alt="${getTranslatedTextFromObject(item.name)}">`;
            } else if (reward.type === 'boost') {
                const boost = boostsData.find(b => b.id === reward.boostId);
                if(boost) previewHTML = `<div style="font-size:16px; color:#00ffff; font-family: 'Orbitron', sans-serif;">${getTranslatedTextFromObject(boost.name)}</div>`;
            }

            rewardEl.innerHTML = `
                <div class="day-number">${translateText('day')} ${dayIndex}</div>
                <div class="reward-preview">${previewHTML}</div>
                <div class="reward-name">${getTranslatedTextFromObject(reward.name)}</div>
            `;
            
            if (isCurrentClaimableDay && claimAvailable) {
                rewardEl.classList.add('claimable');
                rewardEl.addEventListener('click', () => claimDailyReward(reward, index));
            } else if (isLastClaimedDay && !claimAvailable) {
                 rewardEl.classList.add('claimed');
                const overlay = document.createElement('div');
                overlay.className = 'claimed-overlay';
                overlay.innerHTML = `<span>${translateText('claimedBtn')}</span>`;
                rewardEl.appendChild(overlay);
            }
            dom.dailyRewardsGrid.appendChild(rewardEl);
        });
    }
    
    function claimDailyReward(rewardData, index) {
        if (playerStats.lastClaimDate === new Date().toDateString()) {
            dom.dailyRewardMessage.textContent = translateText('dailyRewardAlreadyClaimed');
            return;
        }
        sfx.claim.currentTime=0; sfx.claim.play();

        if (rewardData.type === 'balance') currentBalance += rewardData.amount;
        else if (rewardData.type === 'xp') playerStats.xp += rewardData.amount;
        else if (rewardData.type === 'item') {
            const item = itemsData.find(i => i.id === rewardData.itemId);
            if (item) {
                checkAndAddNewlyCollected(item.id);
                inventory.push({ ...item, internalId: nextItemId++, type: 'item', isFavorite: false });
                playerStats.collection[item.id] = true;
            }
        } else if (rewardData.type === 'boost') {
            const boost = boostsData.find(b => b.id === rewardData.boostId);
            if (boost && !inventory.some(i => i.id === boost.id)) {
                inventory.push({ ...boost, type: 'boost', isFavorite: false });
            }
        }
        
        playerStats.lastClaimDate = new Date().toDateString();
        playerStats.dailyRewardCycle++;
        dom.dailyRewardMessage.textContent = translateText('dailyRewardClaimed', { day: index + 1 });
        updateDailyRewardsUI();
        updateDailyRewardNotification();
        updateUI();
    }

    function checkAchievements() {
        achievementsData.forEach(ach => {
            const achProgress = playerStats.achievements.find(pa => pa.id === ach.id);
            if (achProgress?.completed) return;

            let isCompleted = false;
            const target = ach.target;
            if (target.caseOpened && playerStats.caseOpened >= target.caseOpened) isCompleted = true;
            if (target.totalMoneyEarned && playerStats.totalMoneyEarned >= target.totalMoneyEarned) isCompleted = true;
            if (target.hasRarity && playerStats.raritiesWon[target.hasRarity]) isCompleted = true;
            if (target.itemsSold && playerStats.itemsSold >= target.itemsSold) isCompleted = true;
            if (target.inventoryCount && inventory.filter(i => i.type === 'item').length >= target.inventoryCount) isCompleted = true;
            if (target.balance && currentBalance >= target.balance) isCompleted = true;
            if (target.xp && playerStats.xp >= target.xp) isCompleted = true;
            if (target.caseCost && currentCaseCost < target.caseCost) isCompleted = true;
            if (target.allBoosts) {
                const ownedBoosts = inventory.filter(i => i.type === 'boost').length;
                if (ownedBoosts === boostsData.length) isCompleted = true;
            }
            if (target.collectionProgress) {
                const uniqueItemsFound = Object.keys(playerStats.collection).filter(id => playerStats.collection[id]).length;
                const totalUniqueItems = itemsData.length;
                if ((uniqueItemsFound / totalUniqueItems) >= target.collectionProgress) isCompleted = true;
            }
            if(target.freeMoneyClaims && playerStats.freeMoneyClaims >= target.freeMoneyClaims) isCompleted = true;
            if(target.ownedBoosts && inventory.filter(i => i.type === 'boost').length >= target.ownedBoosts) isCompleted = true;


            if (isCompleted) {
                if (!achProgress) playerStats.achievements.push({ id: ach.id, completed: true });
                else achProgress.completed = true;
                awardAchievement(ach);
            }
        });
        renderAchievements();
        updateAutoOpenInfo();
        updateAutoOpenToggleVisibility();
    }
    
    function awardAchievement(ach) {
        const reward = ach.reward;
        if (reward.type === "balance") currentBalance += reward.amount;
        else if (reward.type === "xp") playerStats.xp += reward.amount;
        else if (reward.type === "boost") {
            const boost = boostsData.find(b => b.id === reward.boostId);
            if (boost && !inventory.some(i => i.id === boost.id)) {
                inventory.push({ ...boost, type: "boost", isFavorite: false });
            }
        }
        showAchievementToast(ach);
        sfx.win.currentTime = 0; sfx.win.play();
        updateUI();
    }

    function showAchievementToast(achievement) {
        dom.toastTitle.textContent = getTranslatedTextFromObject(achievement.name) || translateText(achievement.id);
        dom.toastDesc.textContent = getTranslatedTextFromObject(achievement.description) || translateText(achievement.id + 'Desc');
        dom.achievementToast.classList.add('show');
        setTimeout(() => {
            dom.achievementToast.classList.remove('show');
        }, 5000);
    }
    
    function updateCsPathUI() {
        dom.csPathRewardsList.innerHTML = '';
        const lastClaimedTier = playerStats.csPathClaimedTiers.length > 0 
            ? csPathData.find(t => t.tier === Math.max(...playerStats.csPathClaimedTiers)) 
            : null;
        const prevTierXP = lastClaimedTier ? lastClaimedTier.xp : 0;
        
        const nextTier = csPathData.find(t => !playerStats.csPathClaimedTiers.includes(t.tier));
        const nextTierXP = nextTier ? nextTier.xp : csPathData[csPathData.length-1].xp;
        
        const totalXpForNext = nextTierXP - prevTierXP;
        const currentXpForNext = playerStats.xp - prevTierXP;

        const progressPercentage = totalXpForNext > 0 ? Math.min((currentXpForNext / totalXpForNext) * 100, 100) : (playerStats.xp >= nextTierXP ? 100 : 0);
        
        dom.csPathProgressBar.style.width = `${progressPercentage}%`;
        dom.csPathXpText.textContent = `${translateText('xpUnit')}: ${playerStats.xp} / ${nextTierXP}`;

        csPathData.forEach(tier => {
            const tierEl = document.createElement('div');
            tierEl.className = 'cs-path-tier';
            const isClaimed = playerStats.csPathClaimedTiers.includes(tier.tier);
            const canClaim = playerStats.xp >= tier.xp && !isClaimed;

            if(isClaimed) tierEl.classList.add('claimed');
            if(canClaim) tierEl.classList.add('unlocked');
            
            let rewardText = '';
            if (tier.reward.type === 'balance') rewardText = `${tier.reward.amount}$`;
            else if (tier.reward.type === 'item') {
                const item = itemsData.find(i => i.id === tier.reward.itemId);
                rewardText = item ? getTranslatedTextFromObject(item.name) : '';
            } else if (tier.reward.type === 'boost') {
                const boost = boostsData.find(b => b.id === tier.reward.boostId);
                rewardText = boost ? getTranslatedTextFromObject(boost.name) : '';
            }

            tierEl.innerHTML = `
                <div class="cs-path-tier-info">
                    <div class="tier-level">${translateText('tier')} ${tier.tier} (${tier.xp} ${translateText('xpUnit')})</div>
                    <div class="tier-reward">${translateText('reward')}: ${rewardText}</div>
                </div>
                <button class="claim-btn" ${!canClaim ? 'disabled' : ''}>${isClaimed ? translateText('claimedBtn') : translateText('claimBtn')}</button>
            `;
            if (canClaim) {
                tierEl.querySelector('.claim-btn').addEventListener('click', () => claimCsPathReward(tier));
            }
            dom.csPathRewardsList.appendChild(tierEl);
        });
    }

    function claimCsPathReward(tierData) {
        if (playerStats.xp < tierData.xp || playerStats.csPathClaimedTiers.includes(tierData.tier)) return;
        
        const reward = tierData.reward;
        if (reward.type === 'balance') currentBalance += reward.amount;
        else if (reward.type === 'item') {
            const item = itemsData.find(i => i.id === reward.itemId);
            if(item) {
                checkAndAddNewlyCollected(item.id);
                inventory.push({ ...item, internalId: nextItemId++, type: 'item', isFavorite: false });
                playerStats.collection[item.id] = true;
            }
        } else if (reward.type === 'boost') {
            const boost = boostsData.find(b => b.id === reward.boostId);
            if (boost && !inventory.some(i => i.id === boost.id)) {
                inventory.push({ ...boost, type: 'boost', isFavorite: false });
            }
        }
        
        sfx.claim.currentTime=0; sfx.claim.play();
        playerStats.csPathClaimedTiers.push(tierData.tier);
        showErrorMessage(translateText('csPathRewardClaimed', {tier: tierData.tier}), 3000, {}, true);
        updateCsPathUI();
        updateUI();
    }
    
    function initializeGame(isReset = false) {
         currentLang = localStorage.getItem('gameLang') || 'tr'; 
         currentBalance = 1000;
         inventory = [];
         nextItemId = 0;
         lastWonItem = null;
         playerStats = { username: null, collection: {}, newlyCollectedItems: [], caseOpened: 0, totalMoneyEarned: 0, raritiesWon: {}, boughtBoost: 0, favoriteCount: 0, xp: 0, dailyRewardCycle: 0, lastClaimDate: null, csPathClaimedTiers: [], achievements: [], itemsSold: 0, inventoryCount: 0, casesOpenedToday: 0, lastCaseOpenDate: null, isMuted: false, luckEvent: null, freeMoneyCooldownEnd: 0, freeMoneyClaims: 0 };
         autoSellRarities = [];
         if (isReset) {
            alert(translateText("gameReset"));
         }
         stopAutoOpen();
         updateAllUI();
         checkUsername();
    }

    function saveGameData() {
        try {
            const data = {
                balance: currentBalance, inventory, nextItemId, playerStats, autoSellRarities,
            };
            localStorage.setItem('gameData_v6', JSON.stringify(data));
            localStorage.setItem('gameLang', currentLang);
        } catch (e) { showErrorMessage("gameSavedError"); }
    }

    function loadGameData() {
        try {
            let savedData = localStorage.getItem('gameData_v6');
            let isMigrated = false;
            
            // **FIX: MIGRATION LOGIC**
            // If v6 save doesn't exist, try to find and migrate v5
            if (!savedData) {
                const oldSaveData = localStorage.getItem('gameData_v5');
                if (oldSaveData) {
                    savedData = oldSaveData;
                    isMigrated = true;
                    console.log("Eski save dosyası (v5) bulundu, v6'ya taşınıyor...");
                }
            }

            currentLang = localStorage.getItem('gameLang') || 'tr';

            if (!savedData) { 
                initializeGame(); 
                return; 
            }
            
            const data = JSON.parse(savedData);
            
            const defaultStats = { username: null, collection: {}, newlyCollectedItems: [], caseOpened: 0, totalMoneyEarned: 0, raritiesWon: {}, boughtBoost: 0, favoriteCount: 0, xp: 0, dailyRewardCycle: 0, lastClaimDate: null, csPathClaimedTiers: [], achievements: [], itemsSold: 0, inventoryCount: 0, casesOpenedToday: 0, lastCaseOpenDate: null, isMuted: false, luckEvent: null, freeMoneyCooldownEnd: 0, freeMoneyClaims: 0 };
            
            currentBalance = data.balance ?? 1000;
            inventory = data.inventory ?? [];
            nextItemId = data.nextItemId ?? 0;
            playerStats = { ...defaultStats, ...(data.playerStats || {}) };
            
            // **FIX: Add internalId to migrated items**
            if (isMigrated) {
                let currentMaxId = nextItemId;
                inventory.forEach(item => {
                    if (item.internalId === undefined) {
                        // In v5, the 'id' was the unique incrementing number
                        item.internalId = item.id;
                        // We also need to re-map the item's static properties from itemsData
                        const itemTemplate = itemsData.find(tpl => tpl.name.en === item.name.en || tpl.name.tr === item.name.tr);
                        if (itemTemplate) {
                            item.id = itemTemplate.id; // set the proper static id
                            item.type = itemTemplate.type; // update type just in case
                        }
                        if (item.internalId >= currentMaxId) {
                            currentMaxId = item.internalId + 1;
                        }
                    }
                });
                nextItemId = currentMaxId;
            }

            if (!Array.isArray(playerStats.csPathClaimedTiers)) playerStats.csPathClaimedTiers = [];
            if (!playerStats.collection) playerStats.collection = {};
            if (!Array.isArray(playerStats.newlyCollectedItems)) playerStats.newlyCollectedItems = [];

            autoSellRarities = data.autoSellRarities ?? [];

            updateAllUI();
            checkUsername();
            
            if (isMigrated) {
                saveGameData(); // Save the newly migrated data as v6
                localStorage.removeItem('gameData_v5'); // Clean up old save
                console.log("Taşıma tamamlandı. Eski save silindi.");
            }

            console.log("Oyun başarıyla yüklendi!");
        } catch (e) {
            console.error("Yükleme hatası:", e);
            showErrorMessage("gameLoadedError");
            initializeGame(true);
        }
    }
    
    function setLanguage(lang) {
        currentLang = lang;
        saveGameData(); 
        document.documentElement.lang = lang.split('-')[0];

        document.querySelectorAll('[data-lang-key]').forEach(element => {
            const key = element.dataset.langKey;
            const translation = translateText(key);

            if (element.hasAttribute('placeholder')) {
                element.placeholder = translation;
                return;
            }
            
            const firstChild = element.childNodes[0];
            if (element.children.length === 0 || element.classList.contains('menu-text') || element.classList.contains('toggle-label') || element.tagName === 'H3' ) {
                 element.textContent = translation;
            } else if (firstChild && firstChild.nodeType === Node.TEXT_NODE) {
                 firstChild.textContent = translation + ' ';
            }
        });
        
        updateLanguageButtons();
        updateUI();
        renderAchievements();
        updatePatchNotes();
        updateDailyRewardsUI(true);
        updateCsPathUI();
        updateAutoSellStatus();
        populateAdminItemSelect();
    }
    
    function updateUserProfile() {
      if (playerStats && playerStats.username) {
        dom.userProfileDisplay.style.display = 'flex';
        dom.profileUsername.textContent = playerStats.username;
        dom.profileAvatar.src = `https://api.dicebear.com/8.x/initials/svg?seed=${encodeURIComponent(playerStats.username)}`;
      } else {
        dom.userProfileDisplay.style.display = 'none';
      }
    }

    function updateAllUI() {
        setLanguage(currentLang);
        updateUI();
        populateBoostShop();
        loadAutoSellSettings();
        updateAutoOpenInfo();
        updateDailyRewardNotification();
        toggleMute(playerStats.isMuted, true);
        populateAdminItemSelect();
        updateUserProfile();
        updateAutoOpenToggleVisibility();
    }

    function updateUI() {
        dom.balanceAmount.textContent = Math.round(currentBalance);
        dom.xpAmount.textContent = playerStats.xp;
        applyBoostEffects();
        updateInventory();
        saveGameData();
    }
    
    function gameLoop() {
        updateTime();
        handleHourlyEvent();
        updateFreeMoneyButton();
        if(document.getElementById('dailyRewardModal').classList.contains('show')) {
            updateDailyRewardsUI(true);
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        dom.preloader.classList.add('hidden');
        dom.preloader.addEventListener('transitionend', () => dom.preloader.remove());
        
        loadGameData();
        
        mainGameLoopInterval = setInterval(gameLoop, 1000);
        
        dom.openBtn.addEventListener("click", () => openCase(false));
        dom.sellItemBtn.addEventListener('click', () => { if(sellItem(currentModalItem)) closeModal('itemDetailsModal'); });
        dom.favoriteItemBtn.addEventListener('click', toggleFavorite);
        dom.rarityFilter.addEventListener('change', applyInventoryFilters);
        dom.typeFilter.addEventListener('change', applyInventoryFilters);
        dom.saveAutoSellBtn.addEventListener('click', saveAutoSellSettings);
        dom.autoOpenStartBtn.addEventListener('click', startAutoOpen);
        dom.autoOpenStopBtn.addEventListener('click', stopAutoOpen);
        dom.sellLastBtn.addEventListener('click', sellLastItem);
        dom.muteBtn.addEventListener('click', () => toggleMute());
        dom.saveUsernameBtn.addEventListener('click', saveUsername);
        dom.usernameInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') saveUsername(); });
        document.addEventListener('keydown', handleAdminPanelKey);
        dom.autoOpenToggle.addEventListener('change', (e) => {
            if (e.target.checked) {
                startAutoOpen();
            } else {
                stopAutoOpen();
            }
        });
        dom.freeMoneyBtn.addEventListener('click', claimFreeMoney);

        document.getElementById("main-menu-btn").addEventListener('click', () => {
            updateDailyRewardNotification();
            openModal('mainMenuModal');
        });
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (event) => {
                if (event.target === overlay && overlay.id !== 'usernameModal' && overlay.id !== 'specialWinModal') {
                     closeModal(overlay.id);
                }
            });
        });
        document.querySelectorAll('#language-options button').forEach(button => {
            button.addEventListener('click', () => setLanguage(button.dataset.langCode));
        });
        document.querySelector('button[onclick="resetGameAndConfirm()"]').addEventListener('click', resetGameAndConfirm);
        document.querySelector('button[onclick="sellAllFilteredItems()"]').addEventListener('click', sellAllFilteredItems);
    });

    window.addEventListener('beforeunload', saveGameData);

    function updateLanguageButtons(){
        document.querySelectorAll('#language-options button').forEach(button => {
            button.classList.toggle('selected', button.dataset.langCode === currentLang);
        });
    }

    function updateTime() { dom.currentTime.textContent = new Date().toLocaleTimeString(currentLang.split('-')[0]); }

    function openItemDetailsModal(item) {
        currentModalItem = item; 
        const itemName = getTranslatedTextFromObject(item.name);
        dom.modalItemName.textContent = itemName;
        dom.modalItemImage.src = generateItemSVG(item.rarity, item.type);
        if (item.rarity === 'chroma') {
            dom.modalItemImage.style.borderImageSource = 'linear-gradient(to right, red, orange, yellow, green, blue, indigo, violet)';
            dom.modalItemImage.style.animation = 'rgb-bg 4s linear infinite';
            dom.modalItemImage.style.backgroundSize = '400% 400%';
        } else {
            dom.modalItemImage.style.borderImageSource = 'none';
            dom.modalItemImage.style.animation = 'none';
            dom.modalItemImage.style.borderColor = rarityColors[item.rarity];
            dom.modalItemImage.style.boxShadow = `0 0 15px ${rarityColors[item.rarity]}`;
        }
        dom.modalItemRarity.textContent = translateText(`${item.rarity}Rarity`);
        dom.modalItemRarity.style.color = rarityColors[item.rarity];
        if (item.rarity === 'chroma') {
            dom.modalItemRarity.style.animation = 'rgb-text 4s linear infinite';
        } else {
            dom.modalItemRarity.style.animation = 'none';
        }
        dom.modalMessage.textContent = ''; 

        const isBoost = item.type === "boost";
        dom.sellItemBtn.style.display = isBoost ? 'none' : 'inline-block';
        dom.favoriteItemBtn.style.display = isBoost ? 'none' : 'inline-block';
        
        if (isBoost) {
            dom.modalItemSellPrice.textContent = translateText('boostCannotBeSold');
            dom.modalItemSellPrice.style.color = "#FFD700";
        } else {
            const sellPrice = calculateSellPrice(item);
            dom.modalItemSellPrice.textContent = `${translateText('sellBtn')}: ${sellPrice}$`;
            dom.modalItemSellPrice.style.color = "#00ff99";
            dom.favoriteItemBtn.classList.toggle('active', item.isFavorite);
            dom.favoriteItemBtn.textContent = item.isFavorite ? translateText('unfavoriteBtn') : translateText('favoriteBtn');
        }
        openModal('itemDetailsModal');
    }
    
    function sellItem(itemToSell) {
        if (!itemToSell) return false;
        if (itemToSell.type === "boost") {
            showErrorMessage('boostCannotBeSold');
            return false;
        }
        if (itemToSell.isFavorite) {
            showErrorMessage('cannotSellFavorite');
            return false;
        }

        const itemIndex = inventory.findIndex(i => i.internalId === itemToSell.internalId);
        if (itemIndex > -1) {
            const sellPrice = calculateSellPrice(itemToSell);
            currentBalance += sellPrice;
            playerStats.totalMoneyEarned += sellPrice;
            playerStats.itemsSold = (playerStats.itemsSold || 0) + 1;
            inventory.splice(itemIndex, 1);
            
            updateUI();
            checkAchievements();
            return true;
        } 
        return false;
    }
    
    function sellAllFilteredItems() {
        const itemsToSell = inventory.filter(item => {
            const rarityMatch = dom.rarityFilter.value === 'all' || item.rarity === dom.rarityFilter.value;
            const typeMatch = dom.typeFilter.value === 'all' || item.type === dom.typeFilter.value;
            return rarityMatch && typeMatch && item.type !== 'boost' && !item.isFavorite;
        });

        if (itemsToSell.length === 0) {
            showErrorMessage("noFilteredItemsToSell");
            return;
        }

        let totalSoldCount = 0;
        let totalSoldValue = 0;
        const idsToSell = itemsToSell.map(i => i.internalId);

        inventory = inventory.filter(item => {
            if (idsToSell.includes(item.internalId)) {
                const sellPrice = calculateSellPrice(item);
                currentBalance += sellPrice;
                playerStats.totalMoneyEarned += sellPrice;
                totalSoldValue += sellPrice;
                totalSoldCount++;
                return false;
            }
            return true;
        });
        playerStats.itemsSold = (playerStats.itemsSold || 0) + totalSoldCount;
        
        updateUI();
        showErrorMessage("filteredItemsSold", 5000, { count: totalSoldCount, value: totalSoldValue }, true);
        checkAchievements();
    }
    
    function toggleFavorite() {
        if (!currentModalItem || currentModalItem.type === "boost") return;
        const item = inventory.find(i => i.internalId === currentModalItem.internalId);
        if (item) {
            item.isFavorite = !item.isFavorite;
            const itemName = getTranslatedTextFromObject(item.name);
            dom.modalMessage.textContent = translateText(item.isFavorite ? 'favoriteAdded' : 'favoriteRemoved', { item: itemName });
            dom.favoriteItemBtn.classList.toggle('active', item.isFavorite);
            dom.favoriteItemBtn.textContent = item.isFavorite ? translateText('unfavoriteBtn') : translateText('favoriteBtn');
            updateInventory();
            checkAchievements();
        }
    }
    
    function populateBoostShop() {
        dom.boostsContainer.innerHTML = '';
        dom.noBoostsMessage.style.display = boostsData.length === 0 ? 'block' : 'none';
        boostsData.forEach(boost => {
            const hasBoost = inventory.some(item => item.id === boost.id);
            const boostEl = document.createElement("button");
            boostEl.className = `boost-item ${boost.rarity}-boost ${hasBoost ? 'disabled' : ''}`;
            boostEl.innerHTML = `
                <div class="boost-name">${getTranslatedTextFromObject(boost.name)}</div>
                <div class="boost-description">${getTranslatedTextFromObject(boost.description)}</div>
                <div class="boost-price">${boost.price}$</div>
            `;
            boostEl.disabled = hasBoost;
            boostEl.addEventListener('click', () => buyBoost(boost));
            dom.boostsContainer.appendChild(boostEl);
        });
    }

    function buyBoost(boost) {
        if (inventory.some(item => item.id === boost.id)) {
            showErrorMessage("boostAlreadyOwned");
            return;
        }
        if (currentBalance < boost.price) {
            showErrorMessage("notEnoughBalance", 3000, { cost: boost.price });
            return;
        }
        currentBalance -= boost.price;
        inventory.push({ ...boost, type: "boost", isFavorite: false });
        
        updateUI();
        populateBoostShop();
        showErrorMessage(translateText('boostPurchased', { boostName: getTranslatedTextFromObject(boost.name) }), 3000, {}, true);
        sfx.win.currentTime = 0; sfx.win.play();
        checkAchievements();
    }
    
    function startAutoOpen() {
        const completedCount = playerStats.achievements.filter(a => a.completed).length;
        if (completedCount < 5) {
            showErrorMessage("autoOpenMinAchievements", 5000, { count: completedCount });
            syncAutoOpenState(false);
            return;
        }
        if(autoOpenInterval) return;

        syncAutoOpenState(true);
        autoOpenedCases = 0;
        autoOpenInterval = setInterval(async () => {
            if (currentBalance < currentCaseCost || playerStats.casesOpenedToday >= DAILY_CASE_LIMIT) {
                stopAutoOpen();
                return;
            }
            await openCase(true);
            autoOpenedCases++;
            dom.autoOpenCount.textContent = `${translateText('casesOpened')} ${autoOpenedCases}`;
        }, 4000);
    }
    
    function stopAutoOpen() {
        if (autoOpenInterval) {
            clearInterval(autoOpenInterval);
            autoOpenInterval = null;
            showErrorMessage("autoOpenStopped", 3000);
        }
        syncAutoOpenState(false);
    }
    
    function syncAutoOpenState(isOpening) {
        dom.openBtn.disabled = isOpening;
        dom.autoOpenToggle.checked = isOpening;
        dom.autoOpenStartBtn.disabled = isOpening;
        dom.autoOpenStopBtn.disabled = !isOpening;
    }

    function updateAutoOpenToggleVisibility() {
        if (!playerStats || !playerStats.achievements) {
            dom.autoOpenToggleContainer.style.display = 'none';
            return;
        }
        const completedCount = playerStats.achievements.filter(a => a.completed).length;
        if (completedCount >= 5) {
            dom.autoOpenToggleContainer.style.display = 'inline-flex';
        } else {
            dom.autoOpenToggleContainer.style.display = 'none';
        }
    }
    
    function updateAutoOpenInfo() {
        const completedCount = playerStats.achievements.filter(a => a.completed).length;
        dom.autoOpenInfo.textContent = translateText("autoOpenMinAchievements", { count: completedCount });
        dom.autoOpenStartBtn.disabled = completedCount < 5 || autoOpenInterval;
    }
    
    function updateDailyRewardNotification() {
        const today = new Date().toDateString();
        const claimAvailable = playerStats.lastClaimDate !== today;
        const notificationDot = dom.dailyRewardsMenuBtn.querySelector('.notification-dot');
        if (claimAvailable && !notificationDot) {
            const dot = document.createElement('div');
            dot.className = 'notification-dot';
            dom.dailyRewardsMenuBtn.appendChild(dot);
        } else if (!claimAvailable && notificationDot) {
            notificationDot.remove();
        }
    }

    function showErrorMessage(key, time = 3000, replacements = {}, isPositive = false) { 
        dom.errorMessage.style.color = isPositive ? '#00ff99' : '#ff4d4d';
        dom.errorMessage.textContent = translateText(key, replacements);
        dom.errorMessage.classList.add("show");
        setTimeout(() => dom.errorMessage.classList.remove("show"), time);
    } 

    function resetGameAndConfirm() { 
        if (confirm(translateText("confirmResetGame"))) {
            stopAutoOpen();
            clearInterval(mainGameLoopInterval);
            localStorage.clear();
            location.reload();
        }
    }

    function sellLastItem() {
        if (lastWonItem && inventory.some(i => i.internalId === lastWonItem.internalId)) {
            if (sellItem(lastWonItem)) {
                showErrorMessage(translateText('itemSold', { item: getTranslatedTextFromObject(lastWonItem.name), price: calculateSellPrice(lastWonItem) }), 3000, {}, true);
                lastWonItem = null;
                dom.sellLastBtn.disabled = true;
            }
        } else {
            showErrorMessage('noSellableItem');
            dom.sellLastBtn.disabled = true;
        }
    }

    function toggleMute(forceState, initializing = false) {
        if (!initializing) {
            playerStats.isMuted = !playerStats.isMuted;
        } else {
            playerStats.isMuted = forceState ?? false;
        }

        for (const sound in sfx) {
            sfx[sound].muted = playerStats.isMuted;
        }
        dom.muteIconContainer.innerHTML = playerStats.isMuted ? svgIcons.volumeOff : svgIcons.volumeOn;
        if(!initializing) saveGameData();
    }

    function checkUsername() {
        if (!playerStats.username) {
            openModal('usernameModal');
        }
    }

    function saveUsername() {
        const username = dom.usernameInput.value.trim();
        if (username) {
            playerStats.username = username;
            saveGameData();
            closeModal('usernameModal');
            updateUserProfile();
        }
    }

    function showGlobalAnnouncement(username, itemData) {
        const itemName = getTranslatedTextFromObject(itemData.name);
        dom.globalAnnouncement.innerHTML = `🏆 ${translateText('globalAnnouncement', { username, itemName })}`;
        dom.globalAnnouncement.classList.add('show');
        setTimeout(() => {
            dom.globalAnnouncement.classList.remove('show');
        }, 6000);
    }

    function renderCollection() {
        dom.collectionGrid.innerHTML = '';
        
        const sortedItems = itemsData.slice().sort((a, b) => (rarityOrder[a.rarity] || 0) - (rarityOrder[b.rarity] || 0));

        let foundCount = 0;
        sortedItems.forEach(item => {
            if (playerStats.collection[item.id]) {
                foundCount++;
            }
            dom.collectionGrid.appendChild(createItemElement(item, true));
        });
        dom.collectionProgress.textContent = `${translateText('collectionProgress')} ${foundCount} / ${itemsData.length}`;
        if (foundCount === itemsData.length) {
            dom.collectionProgress.textContent += ` - ${translateText('allItemsCollected')}`;
        }
    }

    function renderProbabilityTable() {
        dom.probabilityTableBody.innerHTML = '';
        Object.keys(rarityWeights).sort((a,b) => rarityOrder[b] - rarityOrder[a]).forEach(rarity => {
            const chance = (rarityWeights[rarity] || 0) * 100;
            const row = dom.probabilityTableBody.insertRow();
            const rarityName = translateText(`${rarity}Rarity`);
            const rarityColor = rarityColors[rarity];
            const isChroma = rarity === 'chroma';

            row.innerHTML = `
                <td><span style="color:${rarityColor}; font-weight: bold; ${isChroma ? 'animation: rgb-text 4s linear infinite;' : ''}">${rarityName}</span></td>
                <td>${chance.toFixed(4)}%</td>
            `;
        });
    }

    function handleAdminPanelKey(event) {
        if (event.ctrlKey && event.altKey && (event.key === 'a' || event.key === 'A')) {
            event.preventDefault();
            const password = prompt("Admin şifresini girin:");
            if (password === ADMIN_PASSWORD) {
                openModal('adminPanelModal');
            } else if (password) {
                alert("Yanlış şifre!");
            }
        }
    }

    function populateAdminItemSelect() {
        dom.adminItemSelect.innerHTML = '';
        itemsData.forEach(item => {
            const option = document.createElement('option');
            option.value = item.id;
            option.textContent = getTranslatedTextFromObject(item.name);
            dom.adminItemSelect.appendChild(option);
        });
    }

    function adminAddBalance() {
        const amount = parseInt(document.getElementById('adminBalance').value, 10);
        if (!isNaN(amount)) {
            currentBalance += amount;
            updateUI();
        }
    }

    function adminAddXp() {
        const amount = parseInt(document.getElementById('adminXp').value, 10);
        if (!isNaN(amount)) {
            playerStats.xp += amount;
            updateUI();
            updateCsPathUI();
        }
    }

    function adminAddItem() {
        const itemId = dom.adminItemSelect.value;
        const itemData = itemsData.find(i => i.id === itemId);
        if (itemData) {
            checkAndAddNewlyCollected(itemData.id);
            const newItem = { ...itemData, internalId: nextItemId++, type: "item", isFavorite: false };
            inventory.push(newItem);
            playerStats.collection[itemData.id] = true;
            updateInventory();
            saveGameData();
        }
    }

    function handleHourlyEvent() {
        const now = new Date();
        const minutes = now.getMinutes();
        const seconds = now.getSeconds();
        const eventDurationMinutes = 5; 

        const currentEvent = playerStats.luckEvent;
        const isEventActive = currentEvent && now < new Date(currentEvent.endTime);
        const wasEventActive = dom.body.classList.contains('event-active');

        if (minutes < eventDurationMinutes && !isEventActive) {
            const multiplier = Math.floor(Math.random() * 4) + 2; // 2x to 5x
            const endTime = new Date(now);
            endTime.setMinutes(eventDurationMinutes, 0, 0); 
            
            playerStats.luckEvent = { multiplier, endTime: endTime.toISOString() };
            updateUI();
            
            dom.body.classList.add('event-starting');
            setTimeout(() => dom.body.classList.remove('event-starting'), 2500);
        }

        const newEventActiveState = playerStats.luckEvent && now < new Date(playerStats.luckEvent.endTime);
        
        if (newEventActiveState) {
            if(!wasEventActive) dom.body.classList.add('event-active');
            dom.eventTimerBar.style.display = 'block';
            dom.eventTimerBar.style.background = 'linear-gradient(45deg, gold, orange)';

            const endTime = new Date(playerStats.luckEvent.endTime);
            const diff = endTime.getTime() - now.getTime();
            
            const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const s = Math.floor((diff % (1000 * 60)) / 1000);

            dom.eventTimerBar.innerHTML = `
                <span>${translateText('luckEventActive', { multiplier: playerStats.luckEvent.multiplier })}</span>
                <span style="margin: 0 10px;">|</span>
                <span>${translateText('luckEventEnds')} ${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}</span>
            `;
        } else {
            if (wasEventActive) {
                playerStats.luckEvent = null;
                updateUI();
                dom.body.classList.remove('event-active');
            }
            dom.eventTimerBar.style.display = 'block';
            dom.eventTimerBar.style.background = 'linear-gradient(45deg, #222, #444)';

            const minutesToNextHour = 59 - minutes;
            const secondsToNextMinute = 59 - seconds;
            dom.eventTimerBar.innerHTML = `
                <span>${translateText('luckEventStarts')} ${minutesToNextHour.toString().padStart(2, '0')}:${secondsToNextMinute.toString().padStart(2, '0')}</span>
            `;
        }
    }
    
    function claimFreeMoney() {
        if(currentBalance < 500 && Date.now() > playerStats.freeMoneyCooldownEnd) {
            currentBalance += 100;
            playerStats.freeMoneyCooldownEnd = Date.now() + 60000; // 1 minute cooldown
            playerStats.freeMoneyClaims++;
            updateUI();
            updateFreeMoneyButton();
            showErrorMessage('freeMoneyClaimed', 2000, {}, true);
            checkAchievements();
        }
    }
    
    function updateFreeMoneyButton() {
        const now = Date.now();
        if (currentBalance < 500) {
            dom.freeMoneyBtn.style.display = 'flex';
            if (now > playerStats.freeMoneyCooldownEnd) {
                dom.freeMoneyBtn.disabled = false;
                dom.freeMoneyBtn.textContent = translateText('freeMoneyBtnText');
            } else {
                dom.freeMoneyBtn.disabled = true;
                const remaining = Math.ceil((playerStats.freeMoneyCooldownEnd - now) / 1000);
                dom.freeMoneyBtn.textContent = `${remaining}s`;
            }
        } else {
            dom.freeMoneyBtn.style.display = 'none';
        }
    }
    
    async function showSpecialWin(itemData) {
      return new Promise(resolve => {
        const itemName = getTranslatedTextFromObject(itemData.name);
        const itemRarity = translateText(`${itemData.rarity}Rarity`);
        const itemColor = rarityColors[itemData.rarity];

        dom.specialWinTitle.style.color = itemColor;
        dom.specialWinItemImage.src = generateItemSVG(itemData.rarity, itemData.type);
        dom.specialWinItemName.textContent = itemName;
        dom.specialWinItemName.style.color = itemColor;
        dom.specialWinItemRarity.textContent = itemRarity;
        dom.specialWinItemRarity.style.color = itemColor;

        if (itemData.rarity === 'chroma') {
            dom.specialWinTitle.style.animation = 'rgb-text 4s linear infinite';
            dom.specialWinItemName.style.animation = 'rgb-text 4s linear infinite';
            dom.specialWinItemRarity.style.animation = 'rgb-text 4s linear infinite';
        } else {
            dom.specialWinTitle.style.animation = `special-win-text-glow 2s infinite alternate`;
            dom.specialWinTitle.style.textShadow = `0 0 15px ${itemColor}, 0 0 30px ${itemColor}`;
            dom.specialWinItemName.style.animation = 'none';
            dom.specialWinItemRarity.style.animation = 'none';
        }

        openModal('specialWinModal');
        sfx.specialWin.currentTime = 0;
        sfx.specialWin.play();

        setTimeout(() => {
            closeModal('specialWinModal');
            dom.result.innerHTML = `${translateText('youWon')} <span class="${itemData.rarity} highlight">${itemName}</span>`;
            resolve();
        }, 4000);
      });
    }

  </script>
</body>
</html>
